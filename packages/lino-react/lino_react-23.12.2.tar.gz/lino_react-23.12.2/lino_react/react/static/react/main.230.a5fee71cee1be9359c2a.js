"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[230],{1230:(e,t,n)=>{n.r(t),n.d(t,{ABCComponent:()=>D,Labeled:()=>O,LeafComponentBase:()=>Z,LeafComponentDelayedValue:()=>A,LeafComponentInput:()=>N,LeafComponentInputChoices:()=>L,maintainTableWidth:()=>R,name:()=>E});var a=n(957),i=n(2875),l=n(6042),r=n(5223),s=n(4782),o=n(2594),u=n(9840),p=n(9430),d=n(8091),c=n(3424),h=n(6637),f=n.n(h),m=n(1914),_=n(2972),y=n.n(_),v=n(9281),b=n(1300);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,p.Z)(e);if(t){var i=(0,p.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var W,E="LinoComponentUtils";W={classNames:n.e(473).then(n.t.bind(n,4507,23)),queryString:Promise.all([n.e(473),n.e(521)]).then(n.t.bind(n,5198,19)),prDropdown:Promise.all([n.e(444),n.e(55),n.e(165),n.e(973)]).then(n.bind(n,367)),prInputText:Promise.all([n.e(295),n.e(55),n.e(165)]).then(n.bind(n,8706))};function T(e){return function(t){t.data.hasOwnProperty("master_data")&&e.props[b.URL_PARAM_WINDOW_TYPE]!==b.WINDOW_TYPE_TABLE&&Object.keys(t.data.master_data).includes(e.props.elem.name)&&e.setState({value:t.data.master_data[e.props.elem.name]})}}function R(e,t){var n;n=void 0!==e?e:this;var a=Object.keys(n.flexs);(void 0!==t?a.length===t:a.length>1)&&a.forEach((function(e){var t=document.getElementById(e).getElementsByClassName("p-datatable");1===t.length&&((t=t[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>n.flexs[e]&&Array.from(t.querySelectorAll(".p-datatable table")).forEach((function(e){Array.from(e.classList).join(" ").includes("p-datatable")&&e.style.setProperty("table-layout","auto")})))}))}(0,v.RegisterImportPool)(W);var O=function(e){var t=(0,v.getExReady)(W,["classNames"]),n=e.label||e.elem.label;return t.ready?m.createElement(m.Fragment,null,!e.hide_label&&n&&m.createElement(m.Fragment,null,m.createElement("label",{className:t.classNames.default("l-label",{"l-label--unfilled":!e.isFilled}),title:Object.assign({},e.elem.value||{}).quicktip||e.elem.help_text},n,":"),e.helpText&&m.createElement("span",{style:{float:"right",cursor:"pointer"},title:e.helpText},"?"),m.createElement("br",null)),e.children):null};O.propTypes={label:y().string,elem:y().object.isRequired,hide_label:y().bool,isFilled:y().bool,helpText:y().string,children:y().element.isRequired},O.defaultProps={hide_label:!1,isFilled:!1};var D=function(){function e(){(0,d.Z)(this,e)}return(0,c.Z)(e,null,[{key:"getValueByName",value:function(e){var t=e.name,n=e.props,a=e.context;return n[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_PARAMS?a.param_values[t]:n[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?a.rows[n.column.rowIndex][t]:n[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_CARDS?a[t]:a.data[t]}}]),e}(),Z=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var a;return(0,d.Z)(this,n),(a=t.call(this,e)).filled=function(){return!["",null,void 0].includes(a.getValue())},a.wrapperClasses=[],a.dataKey=e[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?e.elem.fields_index:e.elem.name,a.filled=a.filled.bind((0,s.Z)(a)),a.getValue=a.getValue.bind((0,s.Z)(a)),a.getValueByName=a.getValueByName.bind((0,s.Z)(a)),a.innerHTML=a.innerHTML.bind((0,s.Z)(a)),a.setLeafRef=a.setLeafRef.bind((0,s.Z)(a)),a}return(0,c.Z)(n,[{key:"getValueByName",value:function(e){return D.getValueByName({name:e,props:this.props,context:this.context})}},{key:"getValue",value:function(){return this.getValueByName(this.dataKey)}},{key:"innerHTML",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getValue()||" ";return e?m.createElement("div",{style:t,dangerouslySetInnerHTML:{__html:n}}):m.createElement("div",{style:t},n)}},{key:"setLeafRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.input,n=void 0!==t&&t,a=e.type,i=void 0===a?"":a;this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_DETAIL&&this.props.urlParams.controller.dataContext.setLeafRef({name:"slave"===i?this.actorID:this.props.elem.name,ref:this,input:n,type:i})}}]),n}(v.Component);Z.requiredModules=["classNames"],Z.iPool=W,Z.contextType=v.DataContextType,Z.propTypesFromLinoLayout=(0,l.Z)({column:y().object,editing_mode:y().bool,hide_label:y().bool},b.URL_PARAM_WINDOW_TYPE,y().oneOf([b.WINDOW_TYPE_TABLE,b.WINDOW_TYPE_DETAIL,b.WINDOW_TYPE_CARDS,b.WINDOW_TYPE_GALLERIA,b.WINDOW_TYPE_INSERT,b.WINDOW_TYPE_PARAMS,b.WINDOW_TYPE_UNKNOWN])),Z.propTypes=P(P({},Z.propTypesFromLinoLayout),{},{elem:y().object.isRequired,tabIndex:y().number.isRequired,urlParams:y().object.isRequired}),Z.defaultProps=(0,l.Z)({editing_mode:!1,hide_label:!1},b.URL_PARAM_WINDOW_TYPE,b.WINDOW_TYPE_UNKNOWN);var A=function(e){(0,o.Z)(a,e);var t,n=I(a);function a(e){var t;return(0,d.Z)(this,a),(t=n.call(this,e)).state=P(P({},t.state),{},{value:null,data_url:null}),t.actorID=e.elem.actor_id||(e.elem.name.includes(".")?e.elem.name:"".concat(e.urlParams.packId,".").concat(e.elem.name)),t.shouldComponentUpdate=t.shouldComponentUpdate.bind((0,s.Z)(t)),t.getData=t.getData.bind((0,s.Z)(t)),t.getValue=t.getValue.bind((0,s.Z)(t)),t.update=t.update.bind((0,s.Z)(t)),t}return(0,c.Z)(a,[{key:"prepare",value:(t=(0,i.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.Z)((0,p.Z)(a.prototype),"prepare",this).call(this);case 2:if(t=(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this),this.props.urlParams.controller.filled(t)){e.next=5;break}return e.abrupt("return");case 5:this.delayed=t.hasOwnProperty("delayed_value_url");case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onReady",value:function(){var e=(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this);this.delayed?(this.setLeafRef({type:"slave"}),this.getData(e.delayed_value_url)):this.setState({value:e})}},{key:"shouldComponentUpdate",value:function(e,t){return this.delayed?this.state.value!==t.value||null!==this.state.value&&(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this).delayed_value_url!==this.state.data_url:this.state.value!==(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this)}},{key:"componentDidUpdate",value:function(e,t){this.delayed?this.state.data_url!==(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this).delayed_value_url&&(this.setState({value:null}),this.update()):this.setState({value:(0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this)})}},{key:"getValue",value:function(){return this.state.value}},{key:"getData",value:function(e){var t=this;this.props.urlParams.controller.actionHandler.silentFetch({path:"".concat(e,"?").concat(this.ex.queryString.stringify(this.props.urlParams.controller.actionHandler.defaultStaticParams()))}).then((function(n){t.setState({value:n.data,data_url:e})}))}},{key:"update",value:function(){this.getData((0,r.Z)((0,p.Z)(a.prototype),"getValue",this).call(this).delayed_value_url)}}]),a}(Z);A.requiredModules=["queryString"].concat(Z.requiredModules);var N=function(e){(0,o.Z)(r,e);var t,n=I(r);function r(e){var t;return(0,d.Z)(this,r),(t=n.call(this,e)).onKeyDown=function(e){return null},t.styleClasses=["disabled-input","l-card","unsaved-modification"],t.componentWillUnmount=t.componentWillUnmount.bind((0,s.Z)(t)),t.disabled=t.disabled.bind((0,s.Z)(t)),t.filled=t.filled.bind((0,s.Z)(t)),t.getCellStyleClasses=t.getCellStyleClasses.bind((0,s.Z)(t)),t.getInput=t.getInput.bind((0,s.Z)(t)),t.onChangeUpdate=t.onChangeUpdate.bind((0,s.Z)(t)),t.onInputRef=t.onInputRef.bind((0,s.Z)(t)),t.onRef=t.onRef.bind((0,s.Z)(t)),t.setCellStyle=t.setCellStyle.bind((0,s.Z)(t)),t.submit=t.submit.bind((0,s.Z)(t)),t.tabIndexMatch=t.tabIndexMatch.bind((0,s.Z)(t)),t.update=t.update.bind((0,s.Z)(t)),t}return(0,c.Z)(r,[{key:"prepare",value:(t=(0,i.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:function(e){return!0},postOnChange:function(e){return null}},window.addEventListener("message",T(this));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",T(this))}},{key:"disabled",value:function(){if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_CARDS)return!0;if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE){var e=this.context.rows[this.props.column.rowIndex],t=e[e.length-1];return!(!t||!t.meta)&&(!!e[e.length-2]||(e[e.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}},{key:"getCellStyleClasses",value:function(){var e=[];return this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&e.push("unsaved-modification"):(e.push("l-card"),this.props[b.URL_PARAM_WINDOW_TYPE]!==b.WINDOW_TYPE_CARDS&&(this.disabled()?e.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&e.push("unsaved-modification"))),e}},{key:"getInput",value:function(){var e=this;return m.createElement(this.inputState.inputComponent,(0,a.Z)({autoFocus:this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE||void 0,onChange:function(t){e.inputState.onChangeUpdateAssert(t)&&(e.onChangeUpdate(t),e.inputState.postOnChange(t))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||""},this.inputState.inputProps))}},{key:"onChangeUpdate",value:function(e){this.update((0,l.Z)({},this.dataKey,e.target.value)),this.setState({})}},{key:"onInputRef",value:function(e){e&&(this.inputEl=e,this.tabIndexMatch()&&(e.focus?e.focus():e.focusInput?e.focusInput.focus():e.inputRef&&e.inputRef.current.focus()))}},{key:"onRef",value:function(e){var t=this;e&&(this.container=e,this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?this.container=e.closest("td"):this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_DETAIL&&(this.container.onclick=function(e){t.props.editing_mode||t.props.urlParams.controller.history.replaceState({currentInputTabIndex:t.props.tabIndex,currentInputWindowType:t.props[b.URL_PARAM_WINDOW_TYPE],editing_mode:!0})})),this.setCellStyle(this.container)}},{key:"setCellStyle",value:function(e){if(e){var t=this.getCellStyleClasses();this.styleClasses.forEach((function(t){e.classList.remove(t)})),t.forEach((function(t){e.classList.add(t)}))}}},{key:"submit",value:function(){this.props.urlParams.controller.actionHandler.submit({col:this.props.column})}},{key:"tabIndexMatch",value:function(){return this.props[b.URL_PARAM_WINDOW_TYPE]===this.props.urlParams.currentInputWindowType&&this.props.tabIndex===this.props.urlParams.currentInputTabIndex}},{key:"update",value:function(e){this.props.urlParams.controller.actionHandler.update({values:e,elem:this.props.elem,col:this.props.column,windowType:this.props[b.URL_PARAM_WINDOW_TYPE]})}},{key:"render",value:function(){return this.state.ready?(this.container&&this.setCellStyle(this.container),m.createElement(O,(0,a.Z)({},this.props,{elem:this.props.elem,isFilled:this.filled()}),m.createElement("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef},this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getInput():this.innerHTML()))):null}}]),r}(Z);N.requiredModules=["prInputText"].concat(Z.requiredModules);var L=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var a;return(0,d.Z)(this,n),(a=t.call(this,e)).state=P(P({},a.state),{},{hidden_value:null}),a.dataKeyHidden=e[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?e.elem.fields_index_hidden:e.elem.name+"Hidden",a.getInput=a.getInput.bind((0,s.Z)(a)),a.getValue=a.getValue.bind((0,s.Z)(a)),a.innerHTML=a.innerHTML.bind((0,s.Z)(a)),a}return(0,c.Z)(n,[{key:"getValue",value:function(){return{text:(0,r.Z)((0,p.Z)(n.prototype),"getValue",this).call(this),value:this.getValueByName(this.dataKeyHidden)}}},{key:"getInput",value:function(){var e=this;return m.createElement("div",{className:"l-ChoiceListFieldElement",style:{margin_top:"1px"}},m.createElement(this.ex.prDropdown.Dropdown,{tabIndex:this.props.tabIndex,style:{width:"100%"},options:this.options,optionLabel:"text",value:this.getValue().value,showClear:this.props.elem.field_options.allowBlank,onChange:function(t){e.update((0,l.Z)((0,l.Z)({},e.dataKey,t.value),e.dataKeyHidden,t.value)),e.setState({})},ref:this.onInputRef}))}},{key:"innerHTML",value:function(){var e=(0,r.Z)((0,p.Z)(n.prototype),"getValue",this).call(this)||" ";return m.createElement("div",{style:{whiteSpace:"nowrap"}},e)}}]),n}(N);L.requiredModules=["prDropdown"].concat(N.requiredModules)}}]);
//# sourceMappingURL=main.230.a5fee71cee1be9359c2a.js.map