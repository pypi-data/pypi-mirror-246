"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[158,521],{1776:(t,e,s)=>{function a(t,e){var s=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}(t,e,"get");return function(t,e){return e.get?e.get.call(t):e.value}(t,s)}s.r(e),s.d(e,{Context:()=>R,Delegate:()=>C,ROUTES:()=>v,name:()=>P});var i=s(1832),n=s(2875),r=s(8091),o=s(3424),c=s(4782),l=s(2594),h=s(9840),u=s(9430),d=s(6637),p=s.n(d),_=s(1300),f=s(9281),x=s(1876);function b(t,e,s){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,s)}function m(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,o=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return r=t.done,t},e:function(t){o=!0,n=t},f:function(){try{r||null==s.return||s.return()}finally{if(o)throw n}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var s,a=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;s=Reflect.construct(a,arguments,i)}else s=a.apply(this,arguments);return(0,h.Z)(this,s)}}var P="NavigationControl",v={home:"/",actor:"/api/:packId/:actorId/:pk?"},g=(0,f.RegisterImportPool)({u:Promise.resolve().then(s.bind(s,765)),queryString:Promise.resolve().then(s.t.bind(s,5198,19)),rrd:s.e(777).then(s.bind(s,1810))}),R=function(t){(0,l.Z)(a,t);var e,s=A(a);function a(){var t;(0,r.Z)(this,a);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(0,h.Z)(t,((t=s.call.apply(s,[this].concat(i))).attachDataContext=function(e){return t.dataContext=e},t.getActorData=function(){var e=(0,n.Z)(p().mark((function e(s){var a,i,n,r,o,c,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=window.localStorage,i=t.APP.state.user_settings.su_user_type||t.APP.state.user_settings.user_type,n=t.APP.data.selectedLanguage||t.APP.state.user_settings.lang,r="ActorData_".concat(i,"_").concat(n,"_").concat(t.APP.state.user_settings.site_name,"_").concat(s),!(o=a.getObject(r))){e.next=5;break}return e.abrupt("return",o);case 5:return c="/media/cache/json/",l=t.APP.state.site_data.no_user_model,c+=l?"Lino_".concat(s,"_").concat(n,".json"):"Lino_".concat(s,"_").concat(i,"_").concat(n,".json"),c+="?v=".concat(Math.round(1e6*Math.random()).toString()),e.next=10,t.actionHandler.silentFetch({path:c});case 10:return o=e.sent,a.setObject(r,o),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.newSlug=function(){return Math.round(1e5*Math.random()).toString()},t.setActionHandler=function(e){return t.actionHandler=e},t.setContextType=function(e){return t.contextType=e},t.setRoot=function(e){t.root=e},(0,c.Z)(t)))}return(0,o.Z)(a,[{key:"computeStatic",value:function(){this.static={isMobile:this.ex.u.isMobile()}}},{key:"onReady",value:function(t){var e=this,s=t.APP,a=t.value,i=t.root,n=t.next;this.computeStatic=this.computeStatic.bind(this),this.APP=s,a.controller=this,this.value=a,this.history=new O(this),this.root=i,this.isSlave=!1,this.parent=null,this.children={},this.delegate={},this.computeStatic(),this.addDelegate=this.addDelegate.bind(this),this.assertAndReflect=this.assertAndReflect.bind(this),this.attachDataContext=this.attachDataContext.bind(this),this.basicContext=w.bind(this),this.build=this.build.bind(this),this.buildURLContext=S.bind(this),this.computeDefaults=this.computeDefaults.bind(this),this.copy=this.copy.bind(this),this.getActorData=this.getActorData.bind(this),this.isModified=this.isModified.bind(this),this.newSlug=this.newSlug.bind(this),this.pushStatus=this.pushStatus.bind(this),this.reflect=this.reflect.bind(this),this.removeDelegate=this.removeDelegate.bind(this),this.setActionHandler=this.setActionHandler.bind(this),this.setContextType=this.setContextType.bind(this),this.setParent=this.setParent.bind(this),this.setRoot=this.setRoot.bind(this),this.storeDetaultInitialize=this.storeDetaultInitialize.bind(this),this.actionHandler=new x.ActionHandler({context:this,next:function(t){return n(e)}})}},{key:"addDelegate",value:function(t,e){this.delegate[t]=e}},{key:"build",value:(e=(0,n.Z)(p().mark((function t(e){var s;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildURLContext(this.APP.router.history.location.pathname);case 2:if(s=t.sent,Object.assign(s,this.parseString(this.APP.router.history.location.search)),!e){t.next=8;break}e(s),t.next=9;break;case 8:return t.abrupt("return",s);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"disabled",value:function(t){return"SingleRow"===this.contextType&&this.dataContext.mutableContext.data&&(this.dataContext.mutableContext.data.disabled_fields[t]||!1)}},{key:"computeDefaults",value:function(t,e,s,a){var i=e.display_mode?this.ex.u.getDisplayMode(e.display_mode,t):void 0;a&&(s.toolbarState=e.hide_top_toolbar?_.TOOLBAR_STATE_HIDDEN:this.static.isMobile?_.TOOLBAR_STATE_PARTIALLY_VISIBLE:_.TOOLBAR_STATE_VISIBLE);var n=[_.DISPLAY_MODE_LIST,_.DISPLAY_MODE_CARDS,_.DISPLAY_MODE_STORY];this.isSlave&&(n=n.concat([_.DISPLAY_MODE_HTML,_.DISPLAY_MODE_SUMMARY])),s[_.URL_PARAM_DISPLAY_MODE]="show"===e.default_action||void 0!==s.pk&&void 0!==e.col?_.DISPLAY_MODE_DETAIL:e.contain_media?_.DISPLAY_MODE_GALLERY:n.includes(i)?i:_.DISPLAY_MODE_TABLE,s[_.URL_PARAM_WINDOW_TYPE]=_.DM_WT_MAP[s[_.URL_PARAM_DISPLAY_MODE]],"show"===e.default_action&&(s.pk=-99998),s.showableColumns=new Map,e.col&&e.col.filter((function(t){return!t.hidden})).forEach((function(t,e){s.showableColumns.set(t.fields_index,t.name)})),!this.filled(s.pk)||this.value.actorId===s.actorId&&this.value.packId===s.packId&&this.filled(this.value.pk)?this.filled(s.pk)&&(s.detailNav=this.value.detailNav):(s.detailNav=new Map,s.rs||(s.rs=this.newSlug()),s.detailNav.set(s.pk,s.rs))}},{key:"copy",value:function(){var t=function t(e){var s=e;if(e instanceof Map){s=new Map;var a,n=m(e);try{for(n.s();!(a=n.n()).done;){var r=(0,i.Z)(a.value,2),o=r[0],c=r[1];s.set(o,t(c))}}catch(t){n.e(t)}finally{n.f()}}else Array.isArray(e)?(s=[],e.forEach((function(t){return s.push(t)}))):e instanceof Object&&(s={},Object.keys(e).forEach((function(a){["controller","static"].includes(a)?s[a]=e[a]:s[a]=t(e[a])})));return s}(this.value);return t}},{key:"isModified",value:function(){if(this.dataContext.isModified())return!0;for(var t=0,e=Object.values(this.children);t<e.length;t++){var s=e[t];if(s.dataContext&&s.dataContext.isModified())return!0}return!1}},{key:"parseString",value:function(t){return this.sanitize(this.ex.queryString.parse(t))}},{key:"pushStatus",value:function(t,e,s){return s=s||e.static&&e.static.actorData||this.value.static.actorData,this.filled(t.base_params)&&(this.filled(t.base_params.mk)&&(e.mk=t.base_params.mk),this.filled(t.base_params.mt)&&(e.mt=t.base_params.mt)),s&&this.filled(t.param_values)&&(e.pv=this.ex.u.pvObj2array(t.param_values,s.params_fields)),this.filled(t.record_id)&&(e.sr=[parseInt(t.record_id)]),e}},{key:"filled",value:function(t){return![null,void 0,""].includes(t)}},{key:"assertAndReflect",value:function(t){var e=this,s=function(){e.root.setState({initialized:!1}),e.reflect(t?null:"push")};this.isModified()?(t&&window.history.pushState(null,null,"/#".concat(this.value.path,"?rs=").concat(this.value.rs)),this.actionHandler.discardModDConfirm({agree:function(e){t?window.history.go(-1):s()},disagree:function(t){e.history.state=e.value}})):s()}},{key:"reflect",value:function(t){if(this.value=this.history.state,this.value.controller=this,!this.isSlave&&t){var e=this.ex.queryString;"push"==t?this.APP.router.history.push("".concat(this.value.path,"?").concat(e.stringify({rs:this.value.rs,mk:this.value.mk,mt:this.value.mt}))):this.APP.router.history[t]()}var s={context:this.value,hasActor:this.value.hasActor,initialized:!0};this.root.setState(s),Object.values(this.delegate).forEach((function(t){return t.root.setState(s)}))}},{key:"removeDelegate",value:function(t){delete this.delegate[t]}},{key:"sanitize",value:function(t){var e=this;return Object.keys(t).forEach((function(s,a){if(!["rs"].includes(s)){var i,n=t[s];i=parseInt(n),e.ex.u.isNaN(i)?"true"!==(i=n.toLowerCase())?"false"!==i||(t[s]=!1):t[s]=!0:t[s]=i}})),t}},{key:"setParent",value:function(t){this.isSlave=!0,this.parent&&delete this.parent.children[this.actionHandler.refName],this.parent=t,t.children[this.actionHandler.refName]=this}},{key:"storeDetaultInitialize",value:function(t){t.sortField=null,t.sortOrder=0,t.hasDetail=!0,t.pvPVisible=!1,t.sr=[],t.gridFilters=new Map,t.filter=[],t.currentInputWindowType=_.WINDOW_TYPE_UNKNOWN,t.currentInputTabIndex=0}}]),a}(f.DynDep);function w(t,e){return k.apply(this,arguments)}function k(){return(k=(0,n.Z)(p().mark((function t(e,s){var a,i;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={path:e,static:{}},this.storeDetaultInitialize(a),i=this.ex.rrd.matchPath(e,{path:v.actor,exact:!1,strict:!1}),Object.assign(a,i.params),a.pk=this.filled(a.pk)?parseInt(a.pk):void 0,t.next=7,this.getActorData("".concat(a.packId,".").concat(a.actorId));case 7:if(a.static.actorData=t.sent,!s){t.next=12;break}s(a),t.next=13;break;case 12:return t.abrupt("return",a);case 13:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function S(t,e){return M.apply(this,arguments)}function M(){return(M=(0,n.Z)(p().mark((function t(e,s){var a,i,n,r,o=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.APP.state.site_data,i={editing_mode:!1,hasActor:"/"!==e||a.use_dashboard_layouts,path:e,static:{}},this.storeDetaultInitialize(i),!i.hasActor){t.next=19;break}if(n=this.ex.rrd.matchPath(e,{path:v.actor,exact:!1,strict:!1})){t.next=11;break}if("/"===e){t.next=7;break}throw"InvalidRouterPath: ".concat(e);case 7:i.packId="system",i.actorId="DashBoard",t.next=12;break;case 11:Object.assign(i,n.params);case 12:return i.pk=i.pk?parseInt(i.pk):void 0,t.next=15,this.getActorData("".concat(i.packId,".").concat(i.actorId));case 15:r=t.sent,i.window_layout=n?r.window_layout:a.choicelists["system.DashboardLayouts"].find((function(t){return t.value===o.APP.state.user_settings.dashboard_layout})).window_layout,this.computeDefaults(this.root.contextEntry.offsetWidth/this.root.chInPx.offsetWidth,r,i,!0),this.ex.u.fillParamDefaults(i,r);case 19:if(!s){t.next=23;break}s(i),t.next=24;break;case 23:return t.abrupt("return",i);case 24:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}R.requiredModules=["u","queryString","rrd"],R.iPool=g;var D=new WeakMap,O=function(){function t(e){var s=this;(0,r.Z)(this,t),b(this,D,{writable:!0,value:new Map}),this.state=null,this.store=function(){return a(s,D)},this.has=function(t){return a(s,D).has(t)},this.load=function(t){var e=t.rs,a=t.lazy,i=void 0!==a&&a;s.state=s.popFromStore(e),s.context.root.setState({initialized:!1}),s.context.assertAndReflect(i)},this.popFromStore=function(t){return a(s,D).get(t)},this.context=e,this.state=e.value,this.has=this.has.bind(this),this.load=this.load.bind(this),this.popFromStore=this.popFromStore.bind(this),this.push=this.push.bind(this),this.pushLazy=this.pushLazy.bind(this),this.pushPath=this.pushPath.bind(this),this.replace=this.replace.bind(this)}var e;return(0,o.Z)(t,[{key:"push",value:function(t){if(t.path===this.state.path&&t[_.URL_PARAM_MASTER_PK]===this.state[_.URL_PARAM_MASTER_PK]&&t[_.URL_PARAM_MASTER_TYPE]===this.state[_.URL_PARAM_MASTER_TYPE])throw"Action not allowed, does not have any effect on router path!";t.rs||(t.rs=this.context.newSlug()),this.state=t,a(this,D).set(t.rs,t),this.context.assertAndReflect(!1)}},{key:"pushLazy",value:function(t){this.state=t,a(this,D).set(t.rs,t),this.context.assertAndReflect(!0)}},{key:"pushPath",value:(e=(0,n.Z)(p().mark((function t(){var e,s,a,i,n,r,o,c=arguments;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=(e=c.length>0&&void 0!==c[0]?c[0]:{}).pathname,a=e.params,i=e.lazy,n=void 0!==i&&i,r=c.length>1?c[1]:void 0,t.next=4,this.context.buildURLContext(s);case 4:o=t.sent,r&&(o=this.context.pushStatus(r,o)),Object.assign(o,a),n?this.pushLazy(o):this.push(o);case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"replace",value:function(t){Object.assign(this.state,t),this.state.noreload&&!t.noreload&&delete this.state.noreload,this.context.reflect(null)}},{key:"replaceState",value:function(t){this.state=Object.assign({},this.state,t),this.state.noreload&&!t.noreload&&delete this.state.noreload,a(this,D).set(this.state.rs,this.state),this.context.reflect(null)}}]),t}(),C=function(){function t(e,s){var a=this;(0,r.Z)(this,t),this.createProperty=this.createProperty.bind(this),this.id=s.newSlug(),this.context=s,s.addDelegate(this.id,this),this.root=e,this._values={},this.value={},Object.keys(s.value).forEach((function(t){return a.createProperty(t)})),this.unset=this.unset.bind(this)}return(0,o.Z)(t,[{key:"createProperty",value:function(t){var e=this;Object.defineProperty(this.value,t,{get:function(){return e._values.hasOwnProperty(t)?e._values[t]:e.context.value[t]},set:function(s){e._values[t]=s}})}},{key:"unset",value:function(){this.context.removeDelegate(this.id)}}]),t}()},5352:t=>{var e="%[a-f0-9]{2}",s=new RegExp("("+e+")|([^%]+?)","gi"),a=new RegExp("("+e+")+","gi");function i(t,e){try{return[decodeURIComponent(t.join(""))]}catch(t){}if(1===t.length)return t;e=e||1;var s=t.slice(0,e),a=t.slice(e);return Array.prototype.concat.call([],i(s),i(a))}function n(t){try{return decodeURIComponent(t)}catch(n){for(var e=t.match(s)||[],a=1;a<e.length;a++)e=(t=i(e,a).join("")).match(s)||[];return t}}t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},s=a.exec(t);s;){try{e[s[0]]=decodeURIComponent(s[0])}catch(t){var i=n(s[0]);i!==s[0]&&(e[s[0]]=i)}s=a.exec(t)}e["%C2"]="�";for(var r=Object.keys(e),o=0;o<r.length;o++){var c=r[o];t=t.replace(new RegExp(c,"g"),e[c])}return t}(t)}}},4885:t=>{t.exports=function(t,e){for(var s={},a=Object.keys(t),i=Array.isArray(e),n=0;n<a.length;n++){var r=a[n],o=t[r];(i?-1!==e.indexOf(r):e(r,o,t))&&(s[r]=o)}return s}},9922:t=>{t.exports=(t,e)=>{if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===e)return[t];const s=t.indexOf(e);return-1===s?[t]:[t.slice(0,s),t.slice(s+e.length)]}},9206:t=>{t.exports=t=>encodeURIComponent(t).replace(/[!'()*]/g,(t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`))},1876:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,s,a){void 0===a&&(a=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,a,i)}:function(t,e,s,a){void 0===a&&(a=s),t[a]=e[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&__createBinding(e,t,s);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionHandler=void 0;const constants=__importStar(__webpack_require__(1300)),Base_1=__webpack_require__(9281),preprocessors_1=__webpack_require__(7215),exModulePromises={queryString:Promise.resolve().then((()=>__importStar(__webpack_require__(5198)))),weakKey:Promise.resolve().then((()=>__importStar(__webpack_require__(9295)))),_:Promise.resolve().then((()=>__importStar(__webpack_require__(8452)))),whatwgFetch:Promise.resolve().then((()=>__importStar(__webpack_require__(7058)))),AbortController:Promise.resolve().then((()=>__importStar(__webpack_require__(4862)))),u:Promise.resolve().then((()=>__importStar(__webpack_require__(765))))};(0,Base_1.RegisterImportPool)(exModulePromises);class URLParser extends Base_1.DynDep{constructor(){super(...arguments),this.parse=t=>{let e=this.ex.queryString.parse(t);return Object.keys(e).forEach((t=>{e[t]=this.parseValue(e[t])})),e},this.parseArray=t=>this.ex.queryString.parse(t.split("array::")[0]).arr,this.parseMap=t=>{let e=new Map,s=this.ex.queryString.parse(t.split("map::")[0]);return s.keyOrder.forEach((t=>{let a=this.parseValue(s[t]);e.set(t,a)})),e},this.parseObject=t=>this.parse(t.split("object::")[0]),this.parseValue=t=>Array.isArray(t)?this.sanitizeArrayParse(t):t.startsWith("array::")?this.parseArray(t):t.startsWith("map::")?this.parseMap(t):t.startsWith("object::")?this.parseObject(t):this.sanitize(t),this.sanitize=t=>{let e;return e=parseInt(t),this.ex.u.isNaN(e)?(e=t.toLowerCase(),"true"===e||"false"!==e&&t):e},this.sanitizeArrayParse=t=>(t.forEach(((e,s)=>{e.startsWith("array::")?t[s]=this.parseArray(e):e.startsWith("map::")?t[s]=this.parseMap(e):e.startsWith("object::")?t[s]=this.parseObject(e):t[s]=this.sanitize(e)})),t),this.sanitizeArrayUnparse=t=>(t.forEach(((e,s)=>{Array.isArray(e)?t[s]=JSON.stringify(e):e instanceof Map?t[s]=this.stringifyMap(e,""):e instanceof Object&&(t[s]=JSON.stringify(e))})),t),this.stringify=t=>{let e={};return Object.keys(t).forEach((s=>{let a=t[s];s===constants.URL_PARAM_GRIDFILTER?e[s]=JSON.stringify(a):Array.isArray(a)?e[s]=this.sanitizeArrayUnparse(a):a instanceof Map?e[s]=this.stringifyMap(a,""):e[s]=a instanceof Object?JSON.stringify(a):a})),this.ex.queryString.stringify(e)},this.stringifyArray=(t,e="array::")=>{let s=[];return t.forEach((t=>{Array.isArray(t)?s.push(this.stringifyArray(t)):t instanceof Map?s.push(this.stringifyMap(t)):t instanceof Object?s.push(this.stringifyObject(t)):s.push(t)})),e+this.ex.queryString.stringify({arr:s})},this.stringifyMap=(t,e="map::")=>{let s=Object.fromEntries(t);return s.keyOrder=Array.from(t.keys()),e+JSON.stringify(s)},this.stringifyObject=(t,e="object::")=>{let s={};return Object.keys(t).forEach((e=>{let a=t[e];Array.isArray(a)?s[e]=this.sanitizeArrayUnparse(a):a instanceof Map?s[e]=this.stringifyMap(a):s[e]=a instanceof Object?this.stringifyObject(a):a})),e+this.ex.queryString.stringify(s)}}onReady({next:t}){t(this)}}URLParser.requiredModules=["queryString","u"],URLParser.iPool=exModulePromises;class ActionHandler extends Base_1.DynDep{constructor(){super(...arguments),this.clearMod=()=>{this.context.dataContext.clearMod();for(const t of Object.values(this.context.children)){let e=t.dataContext;e&&e.clearMod()}},this.cloneState=(t=constants.CLONE_LEVEL_UI)=>{let e={};switch(t){case constants.CLONE_LEVEL_DATA:this.copyData(e);case constants.CLONE_LEVEL_UI:this.getUIConfigParams(e);case constants.CLONE_LEVEL_URL:this.getParams(e)}return e},this.copyData=t=>(t.mutableData={...this.context.dataContext.mutableContext},t.immutableData={...this.context.dataContext.contextBackup},t),this.executeAction=({action:t,actorId:e,status:s,preprocessedStack:a,response_callback:i,rowIndex:n})=>{delete a.callback;let r=a;"GET"===t.http_method&&(r[constants.URL_PARAM_FORMAT]=constants.URL_FORMAT_JSON);let o=`api/${e.split(".").join("/")}`,c=this.context.filled(r.sr)&&r.sr.length?r.sr[0]:null;this.context.filled(c)&&(o+=`/${c}`);const l=e=>{"GET"===t.http_method?this.handledFetch({path:`${o}?${this.parser.stringify(e)}`,response_callback:i}):this.hasFiles()?this.submitFiles(e):this.XHRPutPost({path:o,body:e,response_callback:i},t.http_method)};if(s&&s.rqdata&&s.xcallback)return s.rqdata["xcallback__"+s.xcallback.xcallback_id]=s.xcallback.choice,void l(s.rqdata);let h=Object.assign(this.getParams(),r,this.getModifiedData(n));s&&this.context.filled(s.fv)&&!t.window_action&&Object.assign(h,{fv:s.fv}),l(h)},this.defaultStaticParams=(t={})=>(t[constants.URL_PARAM_MASTER_PK]=this.context.value[constants.URL_PARAM_MASTER_PK],t[constants.URL_PARAM_MASTER_TYPE]=this.context.value[constants.URL_PARAM_MASTER_TYPE],t[constants.URL_PARAM_LINO_VERSION]=this.context.APP.state.site_data.revision_number,t[constants.URL_PARAM_REQUESTING_PANEL]=this.refName,t),this.defaultParams=(t={})=>(this.context.APP.add_su(t),t[constants.URL_PARAM_WINDOW_TYPE]=this.context.value[constants.URL_PARAM_WINDOW_TYPE],this.defaultStaticParams(t),t[constants.URL_PARAM_DISPLAY_MODE]=this.context.value[constants.URL_PARAM_DISPLAY_MODE],t[constants.URL_PARAM_FILTER]=this.context.value[constants.URL_PARAM_FILTER],t[constants.URL_PARAM_USER_LANGUAGE]=this.context.APP.data.selectedLanguage||this.context.APP.state.user_settings.lang,t),this.discardModDConfirm=({agree:t=(t=>{}),disagree:e=(t=>{})})=>{let s=this.context.APP.dialogFactory,a=this.context.newSlug();s.createCallback({actionHandler:this,agree:e=>{this.clearMod(),t(e),s.removeCallback(a)},disagree:t=>{e(t),s.removeCallback(a)},factory:s,id:a,message:"Discard changes to current record?",simple:!0,title:"Confirmation"})},this.multiRowParams=t=>{t[constants.URL_PARAM_PARAM_VALUES]=this.context.value[constants.URL_PARAM_PARAM_VALUES],t[constants.URL_PARAM_START]=this.context.value[constants.URL_PARAM_START],t[constants.URL_PARAM_LIMIT]=this.context.value[constants.URL_PARAM_LIMIT],t[constants.URL_PARAM_SORT]=this.context.value[constants.URL_PARAM_SORT],t[constants.URL_PARAM_SORTDIR]=this.context.value[constants.URL_PARAM_SORTDIR];let e=this.context.value[constants.URL_PARAM_GRIDFILTER];return e.length&&(t[constants.URL_PARAM_GRIDFILTER]=e),t},this.getAction=(t,e=!0)=>{const s=this.context.APP.state.site_data.actions[t],a={an:t};return e&&this.preprocess(s.preprocessor,a),{action:s,preprocessedStack:a}},this.getCallback=t=>"submit_detail"===t?this.submitDetailCallback:t=>{},this.getDefaultContextPath=()=>({pathname:this.context.value.path.slice(1),params:{[constants.URL_PARAM_FORMAT]:constants.URL_FORMAT_JSON}}),this.getGridFilters=()=>Array.from(this.context.value.gridFilters.values()).filter((t=>this.context.filled(t.value))),this.getModifiedData=t=>{let e={};if(!this.context.dataContext)return e;if(this.context.contextType===constants.CONTEXT_TYPE_ACTION)e={...this.context.dataContext.mutableContext.data},delete e.disabled_fields,delete e.disable_editing;else if([void 0,constants.DISPLAY_MODE_DETAIL].includes(t)){let t=this.context.dataContext.mutableContext.data;this.context.dataContext.mutableContext.modified.forEach((s=>{e[s]=t[s],this.context.filled(e[s])||(e[s]=""),t.hasOwnProperty(s+"Hidden")&&(e[s+"Hidden"]=t[s+"Hidden"])}))}else{let s=this.context.value.static.actorData.col,a=this.context.dataContext.mutableContext.rows[t];this.context.dataContext.mutableContext.modifiedRows[t].forEach(((t,i)=>{let n=this.context.value.showableColumns.get(t),r=s.find((e=>e.fields_index===t)).fields_index_hidden;this.context.filled(r)&&(e[n+"Hidden"]=a[r]),e[n]=a[t]}))}return e},this.getParams=(t={})=>(t=this.defaultParams(t),constants.DISPLAY_MODE_DETAIL!==this.context.value[constants.URL_PARAM_DISPLAY_MODE]?this.multiRowParams(t):t),this.getPath=t=>{void 0===t&&(t=this.getDefaultContextPath());let e=this.getParams();return Object.assign(e,t.params),`${t.pathname}?${this.parser.stringify(e)}`},this.getUIConfigParams=(t={})=>(t.editing_mode=this.context.value.editing_mode,t.pvPVisible=this.context.value.pvPVisible,t.showableColumns=this.context.value.showableColumns,t.sortField=this.context.value.sortField,t.sortOrder=this.context.value.sortOrder,t.tab=this.context.value.tab,t.toolbarState=this.context.value.toolbarState,t),this.reload=()=>this.refresh(!0),this.refresh=(t=!1)=>{this.context.dataContext.root.controller.abort(),this.context.dataContext.root.controller=new this.ex.AbortController.default,this.context.setContextType(this.context.value[constants.URL_PARAM_DISPLAY_MODE]===constants.DISPLAY_MODE_DETAIL?constants.CONTEXT_TYPE_SINGLE_ROW:constants.CONTEXT_TYPE_MULTI_ROW),this.handledFetch({path:this.getPath(),signal:this.context.dataContext.root.controller.signal,response_callback:t=>{null!==t&&(this.context.contextType===constants.CONTEXT_TYPE_SINGLE_ROW&&(t.hasOwnProperty("success")||(t.success=!0)),this.context.dataContext.set(t,!1,{loading:!1},(t=>{if(this.context.contextType===constants.CONTEXT_TYPE_SINGLE_ROW)this.context.history.replace({sr:[t.id]});else{let e=this.context.value.static.actorData.pk_index,s=[];t.rows.forEach((t=>{this.context.value.sr.includes(t[e])&&s.push(t[e])})),this.context.history.replace({sr:s})}})))}},(()=>{t?this.context.dataContext.root.setState({displayMode:null,loading:!0}):this.context.dataContext.root.setState({loading:!0})}))},this.refreshDelayedValue=t=>{let e=this.context.dataContext.mutableContext.slaveLeaves;!0===t?Object.values(e).forEach((t=>t.update())):e[t]&&e[t].update()},this.fetch=async({path:t,signal:e,silent:s=!1})=>(s||this.context.APP.setLoadMask(),await this.ex.fetchPolyfill(t,{signal:e}).then(this.handleAjaxResponse).catch((()=>null))),this.silentFetch=async({path:t,signal:e})=>await this.fetch({path:t,signal:e,silent:!0}),this.handledFetch=async({path:t,signal:e,silent:s=!1,response_callback:a},i=(()=>{}))=>{const n=()=>{i(),this.fetch({path:t,signal:e,silent:s}).then((t=>{this.handleActionResponse({response:t,response_callback:a})}))};s||this.context.contextType===constants.CONTEXT_TYPE_ACTION||!this.context.isModified()?n():this.discardModDConfirm({agree:n})},this.handleActionResponse=({response,response_callback})=>{if(response.version_mismatch)return void this.context.APP.reset(null,!0);let aH=this;if(response.info_message&&console.log(response.info_message),response.debug_message&&console.log(response.debug_message),response.warning_message&&console.warn(response.warning_message),response_callback&&response_callback(response),response.xcallback){let{id:t,title:e}=response.xcallback;aH.context.APP.dialogFactory.createCallback({id:t,message:response.message,title:e,xcallback:response.xcallback,actionHandler:aH})}else{if(response.close_window){let t=aH.context.parent.actionHandler;"insert"===aH.context.value.an&&t.context.value.static.actorData&&aH.context.value.static.actorData.id!==t.context.value.static.actorData.id&&t.refreshDelayedValue(aH.context.value.static.actorData.id),aH.context.dataContext.root.forceClose(),aH=t}if(response.eval_js&&eval(response.eval_js),response.record_deleted&&response.success)return aH.context.APP.toast.show({severity:"success",summary:"Success",detail:"Record Deleted"}),aH.context.value.sr=[],void(aH.context.contextType===constants.CONTEXT_TYPE_SINGLE_ROW?aH.context.APP.router.history.goBack():aH.refresh());if(response.success&&"/"===response.goto_url&&response.close_window)aH.context.APP.reset();else{if(response.goto_url){let t=response.goto_url;"#"in response.goto_url&&(t=t.split("#")[1]);let e,s=t.split("?");aH.context.history.pushPath({pathname:e,params:aH.context.parseString(s)})}response.open_url&&window.open(response.open_url),response.message&&(aH.context.APP.toast.show({severity:response.alert?response.alert.toLowerCase():response.success?"success":"info",summary:response.alert||(response.success?"Success":"Info"),detail:response.message}),aH.context.APP.data.user_state_change&&(delete aH.context.APP.data.user_state_change,aH.context.APP.reset(aH.context.APP.state.su_id))),response.clear_site_cache&&(window.localStorage.clear(),aH.context.APP.reset(aH.context.APP.state.su_id)),(response.refresh||response.refresh_all)&&(aH.context.APP.dashboard?aH.context.APP.dashboard.reloadData():aH.reload()),response.refresh_delayed_value&&this.refreshDelayedValue(response.refresh_delayed_value),response.hasOwnProperty("editing_mode")&&aH.context.history.replaceState({editing_mode:response.editing_mode})}}},this.handleAjaxResponse=t=>{this.context.APP.unsetLoadMask();let e=t.status;return e<200?(this.context.APP.toast.show({severity:"warn",summary:"Unknown response",detail:`See for status: ${e}`}),{}):e<400?t.json():e<500?(t.text().then((t=>{this.context.APP.toast.show({severity:"error",summary:"Bad Request",detail:t})})),t.header.map["content-type"].startsWith("application/json")?t.json():{success:!1}):(this.context.APP.setServerError(),{success:!1})},this.hasFiles=()=>null!==this.context.dataContext.mutableContext.FileUploadRequest,this.load=()=>this.refresh(),this.multiRow=(t={},e=this.context)=>{e.history.pushPath({pathname:`/api/${this.context.value.packId}/${this.context.value.actorId}`,params:Object.assign(this.multiRowParams(this.defaultParams()),t)})},this.parseClone=t=>this.parser.parse(t),this.preprocess=(preprocessor,preprocessedStack={})=>{if(!this.context.filled(preprocessor))return preprocessedStack;preprocessors_1.Lino;let fn=eval(preprocessor),ret;return this.context.filled(fn)&&(ret=fn(this.context,preprocessedStack)),this.context.filled(ret)&&ret instanceof Object&&Object.assign(preprocessedStack,ret),preprocessedStack},this.pvArray=()=>{let t=this.context.dataContext.mutableContext.param_values,e=Object.keys(t);return this.context.value.static.actorData.params_fields.map((s=>{let a;return a=e.includes(s+"Hidden")?t[s+"Hidden"]:t[s],void 0===a&&(a=null),a}))},this.runAction=async({an:t,actorId:e,status:s,sr:a=[],rowIndex:i,response_callback:n,clickCatch:r=!1})=>{const{action:o,preprocessedStack:c}=this.getAction(t);let l={action:o,actorId:e,response_callback:n||this.getCallback(t),rowIndex:i,status:s,preprocessedStack:c};if(s&&s.rqdata&&s.xcallback)return this.executeAction(l);if(this.context.filled(a)&&!Array.isArray(a)&&(a=[a]),c.sr=a,s){let t;this.context.value.static.actorData&&this.context.value.static.actorData.id===e||(t=await this.context.getActorData(e)),this.context.pushStatus(s,c,t)}if(o.select_rows&&!c.sr.length&&(c.sr=this.context.value.sr),["grid","detail","show"].includes(t)){delete c.callback;let t={pathname:`/api/${e.split(".").join("/")}${c.sr.length?`/${c.sr[0]}`:""}`,params:c};this.context.history.pushPath(t,{clickCatch:r})}else o.window_action?this.context.APP.dialogFactory.create(this,l):this.executeAction(l)},this.singleRow=(t,e,s=this.context)=>{this.context.value.static.actorData.detail_action?(void 0===e&&(e=t.data[this.context.value.static.actorData.pk_index]),void 0!==e&&s.history.pushPath({pathname:`/api/${this.context.value.packId}/${this.context.value.actorId}/${e}`,params:this.defaultStaticParams()})):console.warn(this.context.value.static.actorData.id+" has no attribute detail_action")},this.stringifyClone=t=>"",this.submit=async({col:t})=>{let e=constants.DISPLAY_MODE_DETAIL;if(void 0!==t&&(e=t.rowIndex),!this.context.dataContext.isModified(e))return void(t||this.context.APP.toast.show({severity:"info",summary:"N/A",detail:"No modified data detected!"}));let s=this.context.dataContext,a={an:"",actorId:this.context.value.static.actorData.id};if(s.root.setState({loading:!0}),void 0!==t){let t=s.mutableContext.rows[e][this.context.value.static.actorData.pk_index],i=null===t;a.an=i?"grid_post":"grid_put",a.sr=i?[]:[t],a.rowIndex=e,a.response_callback=t=>{t.master_data&&window.postMessage({master_data:t.master_data},"*"),void 0!==t.rows?(i&&(s.mutableContext.rows.push(s.contextBackup.rows[e]),s.contextBackup.rows.push(this.ex._.cloneDeep(s.contextBackup.rows[e])),s.mutableContext.count+=1,s.contextBackup.count+=1,s.mutableContext.modifiedRows[e+1]=[]),s.mutableContext.rows[e]=t.rows[0],s.contextBackup.rows[e]=this.ex._.cloneDeep(t.rows[0]),s.mutableContext.modifiedRows[e]=[],s.updateState({...s.mutableContext},{loading:!1})):s.root.setState({loading:!1})}}else if(this.context.contextType===constants.CONTEXT_TYPE_SINGLE_ROW)a.an="submit_detail",a.sr=this.context.value.sr;else{if(this.context.contextType!==constants.CONTEXT_TYPE_ACTION)throw"Unknown client state";a.an="submit_insert",a.response_callback=t=>{}}this.runAction(a)},this.submitDetailCallback=t=>{let e=this.context.dataContext;t.success&&(e.backupContext(t.data_record),e.mutableContext.modified=[],e.updateState(t.data_record)),e.root.setState({loading:!1}),this.context.history.replaceState({editing_mode:!1}),"users.Me"===this.context.value.static.actorData.id&&this.context.APP.reset()},this.submitFiles=t=>{let e=this.context.dataContext.mutableContext.FileUploadRequest;if(this.context.filled(e)){let{xhr:s,formData:a}=e;Object.keys(t).forEach((e=>{this.context.filled(t[e])&&a.append(e,t[e])})),this.context.dataContext.mutableContext.FileUploadRequest=null,s.send(a)}},this.update=({values:t,elem:e,col:s,windowType:a=constants.WINDOW_TYPE_DETAIL})=>{let i=this.context.dataContext;if(a===constants.WINDOW_TYPE_PARAMS)Object.assign(i.mutableContext.param_values,t),this.context.history.replace({[constants.URL_PARAM_PARAM_VALUES]:this.pvArray()});else if(this.context.contextType===constants.CONTEXT_TYPE_MULTI_ROW){let a=i.mutableContext.modifiedRows[s.rowIndex].indexOf(e.fields_index),n=Object.values(t)[0]===i.contextBackup.rows[s.rowIndex][e.fields_index];a<0&&!n?i.mutableContext.modifiedRows[s.rowIndex].push(e.fields_index):a>-1&&n&&i.mutableContext.modifiedRows[s.rowIndex].splice(a,1),Object.assign(i.mutableContext.rows[s.rowIndex],t)}else{let s=i.mutableContext.modified.indexOf(e.name);s<0?i.mutableContext.modified.push(e.name):i.contextBackup.data[e.name]===Object.values(t)[0]&&i.mutableContext.modified.splice(s,1),Object.assign(i.mutableContext.data,t)}},this.XHRPutPost=async({path:t,body:e,signal:s,silent:a=!1,response_callback:i},n)=>{a||this.context.APP.setLoadMask(),this.ex.fetchPolyfill(t,{method:n,body:new URLSearchParams(this.ex.queryString.stringify(e)),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},signal:s}).then(this.handleAjaxResponse).then((t=>{this.handleActionResponse({response:t,response_callback:i})}))}}async prepare(){this.ex.weakKey=this.ex.weakKey.default,this.ex._=this.ex._.default}onReady({context:t,next:e}){this.context=t,this.ex.fetchPolyfill=this.ex.whatwgFetch.fetch,this.refName=this.ex.weakKey(this),t.APP.rps[this.refName]=this,this.cloneState=this.cloneState.bind(this),this.clearMod=this.clearMod.bind(this),this.copyData=this.copyData.bind(this),this.defaultParams=this.defaultParams.bind(this),this.defaultStaticParams=this.defaultStaticParams.bind(this),this.discardModDConfirm=this.discardModDConfirm.bind(this),this.executeAction=this.executeAction.bind(this),this.fetch=this.fetch.bind(this),this.getAction=this.getAction.bind(this),this.getCallback=this.getCallback.bind(this),this.getParams=this.getParams.bind(this),this.getPath=this.getPath.bind(this),this.handledFetch=this.handledFetch.bind(this),this.handleActionResponse=this.handleActionResponse.bind(this),this.handleAjaxResponse=this.handleAjaxResponse.bind(this),this.load=this.load.bind(this),this.multiRowParams=this.multiRowParams.bind(this),this.refresh=this.refresh.bind(this),this.reload=this.reload.bind(this),this.silentFetch=this.silentFetch.bind(this),this.submit=this.submit.bind(this),this.submitDetailCallback=this.submitDetailCallback.bind(this),this.submitFiles=this.submitFiles.bind(this),this.update=this.update.bind(this),this.parser=new URLParser({next:()=>e(this)})}}exports.ActionHandler=ActionHandler,ActionHandler.requiredModules=["u","weakKey","_","whatwgFetch","AbortController","queryString"],ActionHandler.iPool=exModulePromises},7215:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Lino=void 0;let s=window.Lino||{};e.Lino=s,s.get_current_grid_config=(t,e)=>(t.dataContext.root.get_current_grid_config(e),e),s.captureImage=(t,e)=>(e.callback={callback:s=>{t.APP.dialogFactory.createWebcamDialog(t,e,s)},callbackType:"postWindowInit"},e)}}]);
//# sourceMappingURL=main.NavigationControl_App.aed473c1912a1b534967.js.map