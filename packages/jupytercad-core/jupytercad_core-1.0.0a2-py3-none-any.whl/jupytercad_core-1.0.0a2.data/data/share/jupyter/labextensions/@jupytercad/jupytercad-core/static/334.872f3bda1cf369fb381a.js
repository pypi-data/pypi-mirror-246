"use strict";(self.webpackChunk_jupytercad_jupytercad_core=self.webpackChunk_jupytercad_jupytercad_core||[]).push([[334],{5334:(e,t,r)=>{r.r(t),r.d(t,{JupyterCadWidgetFactory:()=>u,JupyterCadWorkerRegistry:()=>v,default:()=>f});var a=r(1140),o=r(3461),n=r(7308),c=r(2419),d=r(5116),s=r(4085),i=r(7527),l=r(4210);class u extends i.ABCWidgetFactory{constructor(e){const{backendCheck:t}=e;super(function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(r[a[o]]=e[a[o]])}return r}(e,["backendCheck"])),this._backendCheck=t,this._commands=e.commands,this._workerRegistry=e.workerRegistry}createNewWidget(e){if(this._backendCheck&&!this._backendCheck())throw new Error("Requested backend is not installed");const{model:t}=e,r=new l.JupyterCadPanel({model:t,workerRegistry:this._workerRegistry}),a=new l.ToolbarWidget({commands:this._commands,model:t});return new l.JupyterCadWidget({context:e,content:r,toolbar:a})}}class p{constructor(e){this.collaborative=!0,this._disposed=!1,this._annotationModel=e.annotationModel}get name(){return"jupytercad-jcadmodel"}get contentType(){return"jcad"}get fileFormat(){return"text"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}preferredLanguage(e){return""}createNew(e){return new o.JupyterCadModel({sharedModel:e.sharedModel,languagePreference:e.languagePreference,annotationModel:this._annotationModel})}}const y="JupyterCAD .jcad Viewer";var g;!function(e){e.createNew="jupytercad:create-new-jcad-file"}(g||(g={}));const m={id:"jupytercad:jcadplugin",requires:[o.IJupyterCadDocTracker,n.IThemeManager,o.IAnnotationToken,c.IFileBrowserFactory,a.ICollaborativeDrive,o.IJCadWorkerRegistryToken],optional:[d.ILauncher,n.ICommandPalette],autoStart:!0,activate:(e,t,r,a,n,c,d,i,l)=>{const m=new u({name:y,modelName:"jupytercad-jcadmodel",fileTypes:["jcad"],defaultFor:["jcad"],tracker:t,commands:e.commands,workerRegistry:d});e.docRegistry.addWidgetFactory(m);const h=new p({annotationModel:a});e.docRegistry.addModelFactory(h),e.docRegistry.addFileType({name:"jcad",displayName:"JCAD",mimeTypes:["text/json"],extensions:[".jcad",".JCAD"],fileFormat:"text",contentType:"jcad"}),c.sharedModelFactory.registerDocumentFactory("jcad",(()=>new o.JupyterCadDoc)),m.widgetCreated.connect(((a,o)=>{o.context.pathChanged.connect((()=>{t.save(o)})),r.themeChanged.connect(((e,t)=>o.context.model.themeChanged.emit(t))),t.add(o),e.shell.activateById("jupytercad::leftControlPanel"),e.shell.activateById("jupytercad::rightControlPanel")})),e.commands.addCommand(g.createNew,{label:e=>"New JCAD File",caption:"Create a new JCAD Editor",icon:e=>e.isPalette?void 0:s.fileIcon,execute:async t=>{var r;const a=t.cwd||(null===(r=n.tracker.currentWidget)||void 0===r?void 0:r.model.path);let o=await e.serviceManager.contents.newUntitled({path:a,type:"file",ext:".jcad"});return o=await e.serviceManager.contents.save(o.path,Object.assign(Object.assign({},o),{format:"text",size:void 0,content:'{\n\t"objects": [],\n\t"options": {},\n\t"metadata": {}\n}'})),e.commands.execute("docmanager:open",{path:o.path,factory:y})}}),i&&i.add({command:g.createNew,category:"Other",rank:1}),l&&l.addItem({command:g.createNew,args:{isPalette:!0},category:"JupyterCAD"})}};class h{constructor(){this.collaborative=!0,this._disposed=!1}get name(){return"jupytercad-stepmodel"}get contentType(){return"step"}get fileFormat(){return"text"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}preferredLanguage(e){return""}createNew(e){return new o.JupyterCadModel({sharedModel:e.sharedModel,languagePreference:e.languagePreference})}}const w={id:"jupytercad:stepplugin",requires:[o.IJupyterCadDocTracker,n.IThemeManager,a.ICollaborativeDrive,o.IJCadWorkerRegistryToken],autoStart:!0,activate:(e,t,r,a,n)=>{const c=new u({name:"JupyterCAD STEP Viewer",modelName:"jupytercad-stepmodel",fileTypes:["step"],defaultFor:["step"],tracker:t,commands:e.commands,workerRegistry:n});e.docRegistry.addWidgetFactory(c);const d=new h;e.docRegistry.addModelFactory(d),e.docRegistry.addFileType({name:"step",displayName:"STEP",mimeTypes:["text/json"],extensions:[".step",".STEP"],fileFormat:"text",contentType:"step"}),a.sharedModelFactory.registerDocumentFactory("step",(()=>new o.JupyterCadStepDoc)),c.widgetCreated.connect(((a,o)=>{o.context.pathChanged.connect((()=>{t.save(o)})),r.themeChanged.connect(((e,t)=>o.context.model.themeChanged.emit(t))),t.add(o),e.shell.activateById("jupytercad::leftControlPanel"),e.shell.activateById("jupytercad::rightControlPanel")}))}};var k=r(4387),C=r(5409),j=r(9053);class v{constructor(){this._registry=new Map}registerWorker(e,t){this._registry.has(e)?console.error("Worker is already registered!"):this._registry.set(e,t)}unregisterWorker(e){this._registry.has(e)||this._registry.delete(e)}getWorker(e){return this._registry.get(e)}getAllWorkers(){return[...this._registry.values()]}}const f=[{id:"jupytercad:core:tracker",autoStart:!0,requires:[j.ITranslator],optional:[C.IMainMenu],provides:o.IJupyterCadDocTracker,activate:(e,t,r)=>{const a=new n.WidgetTracker({namespace:"jupytercad"});return console.log("jupytercad:core:tracker is activated!"),a}},{id:"jupytercad:core:annotation",autoStart:!0,requires:[o.IJupyterCadDocTracker],provides:o.IAnnotationToken,activate:(e,t)=>{var r;const a=new l.AnnotationModel({context:null===(r=t.currentWidget)||void 0===r?void 0:r.context});return t.currentChanged.connect(((e,t)=>{a.context=(null==t?void 0:t.context)||void 0})),a}},{id:"jupytercad:core:worker-registry",autoStart:!0,requires:[],provides:o.IJCadWorkerRegistryToken,activate:e=>{const t=new v,a=new Worker(new URL(r.p+r.u(667),r.b)),o=new k.OccWorker({worker:a});return t.registerWorker(k.OCC_WORKER_ID,o),t}},m,w]}}]);