"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[8328],{18328:(e,t,o)=>{o.r(t),o.d(t,{Annotation:()=>C,AnnotationModel:()=>de,Annotations:()=>N,CommandIDs:()=>d.T,ControlPanelHeader:()=>R,ControlPanelModel:()=>J,FloatingAnnotation:()=>y,FormDialog:()=>l.D,JupyterCadPanel:()=>k,JupyterCadWidget:()=>L,LeftPanelWidget:()=>$,LuminoSchemaForm:()=>B.d,MainView:()=>E,Message:()=>w,ObjectProperties:()=>Y,ObjectPropertiesForm:()=>B.z,ObjectTree:()=>U,PanZoom:()=>Q.I,ReactAnnotations:()=>D,RightPanelWidget:()=>K,Separator:()=>ie,SketcherDialog:()=>ee.y,SketcherModel:()=>te._,SketcherReactWidget:()=>oe.M,TOOLBAR_SEPARATOR_CLASS:()=>ne,ToolbarSwitch:()=>X.OR,ToolbarWidget:()=>ae,UsersItem:()=>se,addCommands:()=>d.n,axesIcon:()=>j.Gw,boxIcon:()=>j.yc,coneIcon:()=>j.Ab,createHeader:()=>z,cutIcon:()=>j.xi,cylinderIcon:()=>j.AB,debounce:()=>j.Ds,distance:()=>X.TE,drawCircle:()=>X.xE,drawLine:()=>X.pS,drawPoint:()=>X.Qd,explodedViewIcon:()=>j.$r,extrusionIcon:()=>j.HZ,focusInputField:()=>j.Dd,getCSSVariableColor:()=>j.pj,getElementFromProperty:()=>j.on,intersectionIcon:()=>j.Y4,itemFromName:()=>j.ro,jcLightIcon:()=>j.S5,minimizeIcon:()=>j.YV,nearest:()=>j.Rq,removeStyleFromProperty:()=>j.ef,requestAPI:()=>j.q7,sphereIcon:()=>j.kT,throttle:()=>j.P2,torusIcon:()=>j.e_,unionIcon:()=>j.eR});var s,n,i,a,d=o(34614),l=o(59331);(a=s||(s={})).LOAD_FILE="LOAD_FILE",a.SAVE_FILE="SAVE_FILE",a.REGISTER="REGISTER",(i=n||(n={})).DISPLAY_SHAPE="DISPLAY_SHAPE",i.INITIALIZED="INITIALIZED",o(50558);var r=o(1745),c=o(23190),h=o(86129),m=o(93119),p=o(12955),u=o(76012),v=o(51040),_=o(12766),g=o(45494),b=o(42122),j=o(83347);const w=e=>{var t,o,s;const{self:n,message:i,user:a}=e,d=null!==(t=null==a?void 0:a.color)&&void 0!==t?t:"black",l=null!==(o=null==a?void 0:a.display_name)&&void 0!==o?o:"",r=null!==(s=null==a?void 0:a.initials)&&void 0!==s?s:"";return m.createElement("div",{className:"jcad-Annotation-Message",style:{flexFlow:n?"row":"row-reverse"}},m.createElement("div",{className:"jcad-Annotation-User-Icon",style:{backgroundColor:d},title:l},m.createElement("span",{style:{width:24,textAlign:"center"}},r)),m.createElement("div",{className:"jcad-Annotation-Message-Content"},m.createElement("p",{style:{padding:7,margin:0}},i)))},C=e=>{const{itemId:t,model:o}=e,s=o.getAnnotation(t),n=m.useMemo((()=>{var e;return null!==(e=null==s?void 0:s.contents)&&void 0!==e?e:[]}),[s]),[i,a]=m.useState("");if(!s)return m.createElement("div",null);const d=()=>{o.addContent(t,i),a("")};return m.createElement("div",{className:"jcad-Annotation"},e.children,m.createElement("div",{style:{paddingBottom:10,maxHeight:400,overflow:"auto"}},n.map((e=>{var t,s;return m.createElement(w,{user:e.user,message:e.value,self:(null===(t=o.user)||void 0===t?void 0:t.username)===(null===(s=e.user)||void 0===s?void 0:s.username)})}))),m.createElement("div",{className:"jcad-Annotation-Message"},m.createElement("textarea",{rows:3,placeholder:"Ctrl+Enter to submit",value:i,onChange:e=>a(e.currentTarget.value),onKeyDown:e=>{e.ctrlKey&&"Enter"===e.key&&d()}}),m.createElement("div",{onClick:d},m.createElement(b.caretRightIcon.react,{className:"jcad-Annotation-Submit"}))))},y=e=>{const{itemId:t,model:o}=e,[s,n]=m.useState(e.open),i=e=>{var s;return e?n(!0):(null===(s=o.getAnnotation(t))||void 0===s?void 0:s.contents.length)?void n(!1):o.removeAnnotation(t)};return m.createElement("div",null,m.createElement("div",{className:"jcad-Annotation-Handler",onClick:()=>i(!s)}),m.createElement("div",{className:"jcad-FloatingAnnotation",style:{visibility:s?"visible":"hidden"}},m.createElement(C,{model:o,itemId:t},m.createElement("div",{className:"jcad-Annotation-Topbar"},m.createElement("div",{onClick:async()=>{var e;if(!(null===(e=o.getAnnotation(t))||void 0===e?void 0:e.contents.length))return o.removeAnnotation(t);(await(0,g.showDialog)({title:"Delete Annotation",body:"Are you sure you want to delete this annotation?",buttons:[g.Dialog.cancelButton(),g.Dialog.okButton({label:"Delete"})]})).button.accept&&o.removeAnnotation(t)}},m.createElement(b.closeIcon.react,{className:"jcad-Annotation-TopBarIcon"})),m.createElement("div",{onClick:()=>{i(!1)}},m.createElement(j.YV.react,{className:"jcad-Annotation-TopBarIcon"}))))))};p.u9r.prototype.computeBoundsTree=u.Xy,p.u9r.prototype.disposeBoundsTree=u.sn,p.Kj0.prototype.raycast=u.uL;const f="--jp-inverse-layout-color4",x="--jp-inverse-layout-color2",S="--jp-brand-color0",O=new p.Ilk((0,j.pj)(f)),M=new p.Ilk((0,j.pj)(x)),I=new p.Ilk((0,j.pj)(S));class E extends m.Component{constructor(e){super(e),this.addContextMenu=()=>{const e=new r.CommandRegistry;e.addCommand("add-annotation",{execute:()=>{var e;if(!this._pointer3D)return;const t=(new p.Pa4).copy(this._pointer3D.mesh.position);if(this._explodedView.enabled){const e=this._computeExplodedState(this._pointer3D.mesh);t.add(e.vector.multiplyScalar(-e.distance))}null===(e=this._model.annotationModel)||void 0===e||e.addAnnotation((0,_.Z)(),{position:[t.x,t.y,t.z],label:"New annotation",contents:[],parent:this._pointer3D.parent.name})},label:"Add annotation",isEnabled:()=>!!this._pointer3D}),this._contextMenu=new c.ContextMenu({commands:e}),this._contextMenu.addItem({command:"add-annotation",selector:"canvas",rank:1})},this.sceneSetup=()=>{if(null!==this.divRef.current){O.set((0,j.pj)(f)),M.set((0,j.pj)(x)),I.set((0,j.pj)(S)),this._camera=new p.cPb(90,2,.1,1e3),this._camera.position.set(8,8,8),this._camera.up.set(0,0,1),this._scene=new p.xsS,this._scene.add(new p.Mig(16777215,.5)),this._cameraLight=new p.cek(16777215,1),this._camera.add(this._cameraLight),this._scene.add(this._camera),this._renderer=new p.CP7({alpha:!0,antialias:!0}),this._renderer.setClearColor(0,0),this._renderer.setSize(500,500,!1),this.divRef.current.appendChild(this._renderer.domElement),this._syncPointer=(0,j.P2)(((e,t)=>{e&&t?this._model.syncPointer({parent:t,x:e.x,y:e.y,z:e.z}):this._model.syncPointer(void 0)}),100),this._renderer.domElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._renderer.domElement.addEventListener("mouseup",(e=>{this._onClick.bind(this)(e)})),this._renderer.domElement.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation(),this._contextMenu.open(e)}));const e=new v.z(this._camera,this._renderer.domElement);e.target.set(this._scene.position.x,this._scene.position.y,this._scene.position.z),this._controls=e,this._controls.addEventListener("change",(()=>{this._updateAnnotation()})),this._controls.addEventListener("change",(0,j.P2)((()=>{var e;(null===(e=this._model.localState)||void 0===e?void 0:e.remoteUser)||this._model.syncCamera({position:this._camera.position.toArray([]),rotation:this._camera.rotation.toArray([]),up:this._camera.up.toArray([])},this.state.id)}),100))}},this.startAnimationLoop=()=>{this._requestID=window.requestAnimationFrame(this.startAnimationLoop),this._controls.update(),this._renderer.setRenderTarget(null),this._renderer.clearDepth(),this._renderer.render(this._scene,this._camera)},this.resizeCanvasToDisplaySize=()=>{null!==this.divRef.current&&(this._renderer.setSize(this.divRef.current.clientWidth,this.divRef.current.clientHeight,!1),"PerspectiveCamera"===this._camera.type?this._camera.aspect=this.divRef.current.clientWidth/this.divRef.current.clientHeight:(this._camera.left=this.divRef.current.clientWidth/-2,this._camera.right=this.divRef.current.clientWidth/2,this._camera.top=this.divRef.current.clientHeight/2,this._camera.bottom=this.divRef.current.clientHeight/-2),this._camera.updateProjectionMatrix())},this.generateScene=()=>{this.sceneSetup(),this.startAnimationLoop(),this.resizeCanvasToDisplaySize()},this.messageHandler=e=>{switch(e.action){case n.DISPLAY_SHAPE:this._saveMeta(e.payload),this._shapeToMesh(e.payload);break;case n.INITIALIZED:if(!this._model)return;this._postMessage({action:s.LOAD_FILE,payload:{content:this._model.getContent()}})}},this._projectVector=e=>{const t=(new p.Pa4).copy(e),o=this._renderer.domElement;return t.project(this._camera),new p.FM8((.5+t.x/2)*o.width,(.5-t.y/2)*o.height)},this._saveMeta=e=>{this._model&&Object.entries(e).forEach((([e,t])=>{this._model.sharedModel.setShapeMeta(e,t.meta)}))},this._shapeToMesh=e=>{var t;null!==this._meshGroup&&this._scene.remove(this._meshGroup),null!==this._explodedViewLinesHelperGroup&&this._scene.remove(this._explodedViewLinesHelperGroup);const o=this._model.sharedModel.getOption("guidata"),s=this._selectedMeshes.map((e=>e.name));if(this._selectedMeshes=[],this._boundingGroup=new p.ZzF,this._meshGroup=new p.ZAu,Object.entries(e).forEach((([e,t])=>{const{faceList:n,edgeList:i,jcObject:a}=t,d=[],l=[],r=[];let c=0;if(0===n.length&&0===i.length)return;n.forEach((e=>{d.push(...e.vertexCoord),l.push(...e.normalCoord);for(let t=0;t<e.triIndexes.length;t+=3)r.push(e.triIndexes[t+0]+c,e.triIndexes[t+1]+c,e.triIndexes[t+2]+c);c+=e.vertexCoord.length/3}));let h=O,m=a.visible;if(o&&o[e]){const t=o[e];if(Object.prototype.hasOwnProperty.call(t,"color")){const e=t.color;h=new p.Ilk(e[0],e[1],e[2])}Object.prototype.hasOwnProperty.call(t,"visibility")&&(m=o[e].visibility)}const u=new p.xoR({color:h,side:p.ehD,wireframe:!1,flatShading:!1,shininess:0}),v=new p.u9r;v.setIndex(r),v.setAttribute("position",new p.a$l(d,3)),v.setAttribute("normal",new p.a$l(l,3)),v.computeBoundingBox(),d.length>0&&v.computeBoundsTree();const _=new p.Kj0(v,u);_.name=e,_.visible=m,m&&this._boundingGroup.expandByObject(_),s.includes(e)&&(this._selectedMeshes.push(_),_.material.color=I);const g=new p.nls({linewidth:5,color:M});i.forEach((e=>{const t=new p.a$l(e.vertexCoord,3),o=new p.u9r;o.setAttribute("position",t);const s=new p.x12(o,g);s.name="edge",_.add(s)})),this._meshGroup&&this._meshGroup.add(_)})),o&&(null===(t=this._model.sharedModel)||void 0===t||t.setOption("guidata",o)),null===this._refLength&&this._meshGroup.children.length){const e=new p.Pa4;this._boundingGroup.getSize(e),this._refLength=Math.max(e.x,e.y,e.z)/5||1,this._updatePointers(this._refLength),this._camera.lookAt(this._scene.position),this._camera.position.set(10*this._refLength,10*this._refLength,10*this._refLength),this._camera.far=200*this._refLength}this._meshGroup.children.length||(this._refLength=null),this._setupExplodedView(),this._scene.add(this._meshGroup),this.setState((e=>Object.assign(Object.assign({},e),{loading:!1})))},this._postMessage=e=>{if(this._worker){const t=Object.assign(Object.assign({},e),{id:this.state.id});this._worker.postMessage(t)}},this._onSharedMetadataChanged=(e,t)=>{const o=Object.assign({},this.state.annotations);t.forEach(((e,t)=>{if(!t.startsWith("annotation"))return;const s=this._model.sharedModel.getMetadata(t);let n=!0;if(this.state.firstLoad&&(n=!1),!s||"add"!==e.action&&"update"!==e.action)"delete"===e.action&&delete o[t];else{const e=JSON.parse(s);e.open=n,o[t]=e}})),this.setState((e=>Object.assign(Object.assign({},e),{annotations:o,firstLoad:!1})))},this._onClientSharedStateChanged=(e,t)=>{var o,s,n,i,a;const d=null===(o=this._model.localState)||void 0===o?void 0:o.remoteUser;if(d){const e=t.get(d);if(!e)return;(null===(s=e.user)||void 0===s?void 0:s.username)!==(null===(n=this.state.remoteUser)||void 0===n?void 0:n.username)&&this.setState((t=>Object.assign(Object.assign({},t),{remoteUser:e.user}))),Array.isArray(e.selected.value)&&this._updateSelected(e.selected.value);const o=e.camera;if(null==o?void 0:o.value){const{position:e,rotation:t,up:s}=o.value;this._camera.position.set(e[0],e[1],e[2]),this._camera.rotation.set(t[0],t[1],t[2]),this._camera.up.set(s[0],s[1],s[2])}}else{if(null!==this.state.remoteUser){this.setState((e=>Object.assign(Object.assign({},e),{remoteUser:null})));const e=null===(a=null===(i=this._model.localState)||void 0===i?void 0:i.camera)||void 0===a?void 0:a.value;if(e){const t=e.position,o=e.rotation,s=e.up;this._camera.position.set(t[0],t[1],t[2]),this._camera.rotation.set(o[0],o[1],o[2]),this._camera.up.set(s[0],s[1],s[2])}}const e=this._model.localState;(null==e?void 0:e.selected)&&Array.isArray(e.selected.value)&&this._updateSelected(e.selected.value)}t.forEach(((e,t)=>{var o,s;const n=null===(o=e.pointer)||void 0===o?void 0:o.value;if(this._model.getClientId()===t)return;let i=this._collaboratorPointers[t];if(n){const o=null===(s=this._meshGroup)||void 0===s?void 0:s.getObjectByName(n.parent);if(!i){const s=this._createPointer(e.user);i=this._collaboratorPointers[t]={mesh:s,parent:o},this._scene.add(s)}if(i.mesh.visible=!0,this._explodedView.enabled){const e=this._computeExplodedState(o),t=e.vector.multiplyScalar(e.distance);i.mesh.position.copy(new p.Pa4(n.x+t.x,n.y+t.y,n.z+t.z))}else i.mesh.position.copy(new p.Pa4(n.x,n.y,n.z));i.parent=o}else this._collaboratorPointers[t]&&(this._collaboratorPointers[t].mesh.visible=!1)}))},this._handleThemeChange=()=>{const e="true"===document.body.getAttribute("data-jp-theme-light");O.set((0,j.pj)(f)),M.set((0,j.pj)(x)),I.set((0,j.pj)(S)),this.setState((t=>Object.assign(Object.assign({},t),{lightTheme:e})))},this._handleWindowResize=()=>{this.resizeCanvasToDisplaySize(),this._updateAnnotation()},this.divRef=m.createRef(),this._selectedMeshes=[],this._meshGroup=null,this._boundingGroup=new p.ZzF,this._explodedView={enabled:!1,factor:0},this._explodedViewLinesHelperGroup=null,this._cameraSettings={type:"Perspective"},this._raycaster=new p.iMs,this._requestID=null,this._refLength=null,this._pointer3D=null,this._geometry=new p.u9r,this._geometry.setDrawRange(0,3e4),this.props.view.changed.connect(this._onViewChanged,this);const t="true"===document.body.getAttribute("data-jp-theme-light");this._worker=e.workerRegistry.getWorker("jupytercadOccWorker");const o=this._worker.initChannel();this._worker.registerHandler(o,this.messageHandler.bind(this)),this.state={id:o,lightTheme:t,loading:!0,annotations:{},firstLoad:!0},this._model=this.props.jcadModel,this._pointer=new p.FM8,this._collaboratorPointers={},this._model.themeChanged.connect(this._handleThemeChange,this),this._model.sharedObjectsChanged.connect(this._onSharedObjectsChanged,this),this._model.sharedOptionsChanged.connect(this._onSharedOptionsChanged,this),this._model.clientStateChanged.connect(this._onClientSharedStateChanged,this),this._model.sharedMetadataChanged.connect(this._onSharedMetadataChanged,this),this._raycaster.params.Line&&(this._raycaster.params.Line.threshold=.1)}componentDidMount(){window.addEventListener("resize",this._handleWindowResize),this.generateScene(),this.addContextMenu()}componentDidUpdate(e,t){this.resizeCanvasToDisplaySize()}componentWillUnmount(){window.cancelAnimationFrame(this._requestID),window.removeEventListener("resize",this._handleWindowResize),this.props.view.changed.disconnect(this._onViewChanged,this),this._controls.dispose(),this._model.themeChanged.disconnect(this._handleThemeChange,this),this._model.sharedOptionsChanged.disconnect(this._onSharedOptionsChanged,this),this._model.sharedObjectsChanged.disconnect(this._onSharedObjectsChanged,this),this._model.clientStateChanged.disconnect(this._onClientSharedStateChanged,this),this._model.sharedMetadataChanged.disconnect(this._onSharedMetadataChanged,this)}_pick(){var e;if(null===this._meshGroup||!this._meshGroup.children)return null;this._raycaster.setFromCamera(this._pointer,this._camera);const t=this._raycaster.intersectObjects(this._meshGroup.children);if(t.length>0)for(const o of t)if(o.object.visible&&(null===(e=o.object.parent)||void 0===e?void 0:e.visible))return{mesh:o.object,position:o.point};return null}_updateAnnotation(){Object.keys(this.state.annotations).forEach((e=>{var t,o;const s=document.getElementById(e);if(s){const n=null===(t=this._model.annotationModel)||void 0===t?void 0:t.getAnnotation(e);let i=new p.FM8;if(n){const e=null===(o=this._meshGroup)||void 0===o?void 0:o.getObjectByName(n.parent),t=new p.Pa4(n.position[0],n.position[1],n.position[2]);if(this._explodedView.enabled&&e){const o=this._computeExplodedState(e),s=o.vector.multiplyScalar(o.distance);t.add(s)}i=this._projectVector(t)}s.style.left=`${Math.round(i.x)}px`,s.style.top=`${Math.round(i.y)}px`}}))}_onPointerMove(e){const t=this._renderer.domElement.getBoundingClientRect();this._pointer.x=(e.clientX-t.left)/t.width*2-1,this._pointer.y=-(e.clientY-t.top)/t.height*2+1;const o=this._pick();if(!this._pointer3D&&this._model.localState&&o&&(this._pointer3D={parent:o.mesh,mesh:this._createPointer(this._model.localState.user)},this._scene.add(this._pointer3D.mesh)),o){if(!this._pointer3D)return void this._syncPointer(void 0,void 0);if(this._pointer3D.mesh.visible=!0,this._pointer3D.mesh.position.copy(o.position),this._pointer3D.parent=o.mesh,this._explodedView.enabled){const e=this._computeExplodedState(this._pointer3D.parent);o.position.add(e.vector.multiplyScalar(-e.distance))}this._syncPointer(o.position,o.mesh.name)}else this._pointer3D&&(this._pointer3D.mesh.visible=!1),this._syncPointer(void 0,void 0)}_onClick(e){const t=this._pick(),o=new Set(this._selectedMeshes.map((e=>e.name)));if(t){let s="";if(s=t.mesh.name.startsWith("edge")?t.mesh.parent.name:t.mesh.name,e.ctrlKey)o.has(s)?o.delete(s):o.add(s);else{const e=o.has(s);o.clear(),e||o.add(s)}const n=Array.from(o);this._updateSelected(n),this._model.syncSelectedObject(n,this.state.id)}}_updatePointers(e){this._pointerGeometry=new p.xo$(e/10,32,32);for(const e in this._collaboratorPointers)this._collaboratorPointers[e].mesh.geometry=this._pointerGeometry}_createPointer(e){var t;let o=null;o=(null===(t=e.color)||void 0===t?void 0:t.startsWith("var"))?h.ZP(getComputedStyle(document.documentElement).getPropertyValue(e.color.slice(4,-1))):h.ZP(e.color);const s=new p.vBJ({color:o?new p.Ilk(o.r/255,o.g/255,o.b/255):"black"});return new p.Kj0(this._pointerGeometry,s)}_updateSelected(e){var t;for(const e of this._selectedMeshes){let t=O;const o=this._model.sharedModel.getOption("guidata");if(o&&o[e.name]&&o[e.name].color){const s=o[e.name].color;t=new p.Ilk(s[0],s[1],s[2])}e.material.color=t}this._selectedMeshes=[];for(const o of e){const e=null===(t=this._meshGroup)||void 0===t?void 0:t.getObjectByName(o);e&&(this._selectedMeshes.push(e),e.material.color=I)}}async _onSharedObjectsChanged(e,t){t.objectChange&&(await this._worker.ready,this._postMessage({action:s.LOAD_FILE,payload:{content:this._model.getContent()}}))}_onSharedOptionsChanged(e,t){var o,s;const n=e.getOption("guidata");if(n)for(const e in n){const t=null===(o=this._meshGroup)||void 0===o?void 0:o.getObjectByName(e);if(t){if(Object.prototype.hasOwnProperty.call(n[e],"visibility")){const o=null===(s=this._explodedViewLinesHelperGroup)||void 0===s?void 0:s.getObjectByName(e),i=n[e];i&&(t.visible=i.visibility,o&&(o.visible=i.visibility))}if("color"in n[e]){const o=n[e].color,s=new p.Ilk(o[0],o[1],o[2]);t.material.color=s}else t.material.color=O}}}_onViewChanged(e,t){var o;if("axes"===t.key){null===(o=this._sceneAxe)||void 0===o||o.removeFromParent();const e=t.newValue;"remove"!==t.type&&e&&e.visible&&(this._sceneAxe=new p.y8_(e.size),this._scene.add(this._sceneAxe))}if("explodedView"===t.key){const e=t.newValue;"remove"!==t.type&&e&&(this._explodedView=e,this._setupExplodedView())}if("cameraSettings"===t.key){const e=t.newValue;"remove"!==t.type&&e&&(this._cameraSettings=e,this._updateCamera())}}_setupExplodedView(){var e,t,o,s;if(this._explodedView.enabled){const o=new p.Pa4;this._boundingGroup.getCenter(o),null===(e=this._explodedViewLinesHelperGroup)||void 0===e||e.removeFromParent(),this._explodedViewLinesHelperGroup=new p.ZAu;for(const e of null===(t=this._meshGroup)||void 0===t?void 0:t.children){const t=this._computeExplodedState(e);e.position.set(0,0,0),e.translateOnAxis(t.vector,t.distance);const o=new p.nls({color:M,linewidth:2}),s=(new p.u9r).setFromPoints([t.oldGeometryCenter,t.newGeometryCenter]),n=new p.x12(s,o);n.name=e.name,n.visible=e.visible,this._explodedViewLinesHelperGroup.add(n)}this._scene.add(this._explodedViewLinesHelperGroup)}else{for(const e of null===(o=this._meshGroup)||void 0===o?void 0:o.children)e.position.set(0,0,0);null===(s=this._explodedViewLinesHelperGroup)||void 0===s||s.removeFromParent()}}_updateCamera(){var e,t;const o=(new p.Pa4).copy(this._camera.position),s=(new p.Pa4).copy(this._camera.up);if(this._camera.remove(this._cameraLight),this._scene.remove(this._camera),"Perspective"===this._cameraSettings.type)this._camera=new p.cPb(90,2,.1,1e3);else{const o=(null===(e=this.divRef.current)||void 0===e?void 0:e.clientWidth)||0,s=(null===(t=this.divRef.current)||void 0===t?void 0:t.clientHeight)||0;this._camera=new p.iKG(o/-2,o/2,s/2,s/-2)}this._camera.add(this._cameraLight),this._scene.add(this._camera),this._controls.object=this._camera,this._camera.position.copy(o),this._camera.up.copy(s)}_computeExplodedState(e){var t;const o=new p.Pa4;this._boundingGroup.getCenter(o);const s=new p.Pa4;null===(t=e.geometry.boundingBox)||void 0===t||t.getCenter(s);const n=new p.Pa4(s.x-o.x,s.y-o.y,s.z-o.z),i=n.length()*this._explodedView.factor;return n.normalize(),{oldGeometryCenter:s,newGeometryCenter:new p.Pa4(s.x+i*n.x,s.y+i*n.y,s.z+i*n.z),vector:n,distance:i}}render(){var e;return m.createElement("div",{className:"jcad-Mainview",style:{border:this.state.remoteUser?`solid 3px ${this.state.remoteUser.color}`:"unset"}},m.createElement("div",{className:"jpcad-Spinner",style:{display:this.state.loading?"flex":"none"}}," ",m.createElement("div",{className:"jpcad-SpinnerContent"})," "),(null===(e=this.state.remoteUser)||void 0===e?void 0:e.display_name)?m.createElement("div",{style:{position:"absolute",top:1,right:3,background:this.state.remoteUser.color}},`Following ${this.state.remoteUser.display_name}`):null,Object.entries(this.state.annotations).map((([e,t])=>{var o;if(!this._model.annotationModel)return null;const s=null===(o=this._meshGroup)||void 0===o?void 0:o.getObjectByName(t.parent),n=new p.Pa4(t.position[0],t.position[1],t.position[2]);if(this._explodedView.enabled&&s){const e=this._computeExplodedState(s),t=e.vector.multiplyScalar(e.distance);n.add(t)}const i=this._projectVector(n);return m.createElement("div",{key:e,id:e,style:{left:i.x,top:i.y},className:"jcad-Annotation-Wrapper"},m.createElement(y,{itemId:e,model:this._model.annotationModel,open:!1}))})),m.createElement("div",{ref:this.divRef,style:{width:"100%",height:"calc(100%)"}}))}}var P=o(61879),A=o(39791),T=o(53968);class L extends P.DocumentWidget{constructor(e){super(e),this.onResize=e=>{window.dispatchEvent(new Event("resize"))}}dispose(){this.content.dispose(),super.dispose()}}class k extends g.ReactWidget{constructor(e){super(),this.addClass("jp-jupytercad-panel"),this._jcadModel=e.model,this._workerRegistry=e.workerRegistry,this._view=new A.ObservableMap}get viewChanged(){return this._view.changed}dispose(){this.isDisposed||(T.Signal.clearData(this),super.dispose())}get axes(){return this._view.get("axes")}set axes(e){this._view.set("axes",e||null)}get explodedView(){return this._view.get("explodedView")}set explodedView(e){this._view.set("explodedView",e||null)}get cameraSettings(){return this._view.get("cameraSettings")}set cameraSettings(e){this._view.set("cameraSettings",e||null)}deleteAxes(){this._view.delete("axes")}render(){return m.createElement(E,{view:this._view,jcadModel:this._jcadModel,workerRegistry:this._workerRegistry})}}class D extends m.Component{constructor(e){super(e);const t=()=>{this.forceUpdate()};this._model=e.model,this._model.contextChanged.connect((async()=>{var o,s,n,i,a,d,l,r;await(null===(s=null===(o=this._model)||void 0===o?void 0:o.context)||void 0===s?void 0:s.ready),null===(a=null===(i=null===(n=this._model)||void 0===n?void 0:n.context)||void 0===i?void 0:i.model)||void 0===a||a.sharedMetadataChanged.disconnect(t),this._model=e.model,null===(r=null===(l=null===(d=this._model)||void 0===d?void 0:d.context)||void 0===l?void 0:l.model)||void 0===r||r.sharedMetadataChanged.connect(t),this.forceUpdate()}))}render(){var e;const t=null===(e=this._model)||void 0===e?void 0:e.getAnnotationIds();if(!t||!this._model)return m.createElement("div",null);const o=t.map((e=>m.createElement("div",null,m.createElement(C,{model:this._model,itemId:e}),m.createElement("hr",{className:"jpcad-Annotations-Separator"}))));return m.createElement("div",null,o)}}class N extends b.PanelWithToolbar{constructor(e){super({}),this.title.label="Annotations",this.addClass("jpcad-Annotations"),this._model=e.model,this._widget=b.ReactWidget.create(m.createElement(D,{model:this._model})),this.addWidget(this._widget)}}var B=o(67388);class R extends c.Widget{constructor(){super({node:z()}),this.title.changed.connect((e=>{this.node.textContent=this.title.label}))}}function z(){const e=document.createElement("h2");return e.textContent="-",e}var V=o(89927);const F=new b.LabIcon({name:"jupytercad:visibilityIcon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0V0z" fill="none" />\n    <path class="jp-icon3" d="M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z" fill="none" />\n</svg>\n'}),G=new b.LabIcon({name:"jupytercad:visibilityOffIcon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none" />\n    <path class="jp-icon3" d="M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z" fill="none" />\n</svg>\n'}),W={labTheme:{text:{fontSize:"14px",fontFamily:"var(--jp-ui-font-family)",color:"var(--jp-ui-font-color1)",selectedColor:"var(--jp-ui-inverse-font-color1)",hoverColor:"var(--jp-ui-font-color2)"},nodes:{folder:{bgColor:"var(--jp-layout-color1)",selectedBgColor:"var(--jp-layout-color2)",hoverBgColor:"var(--jp-layout-color2)"},leaf:{bgColor:"var(--jp-layout-color1)",selectedBgColor:"var(--jp-layout-color2)",hoverBgColor:"var(--jp-layout-color2)"},icons:{size:"9px",folderColor:"var(--jp-inverse-layout-color3)",leafColor:"var(--jp-inverse-layout-color3)"}}}};class U extends b.PanelWithToolbar{constructor(e){super(e),this.title.label="Objects tree";const t=g.ReactWidget.create(m.createElement(H,{cpModel:e.controlPanelModel}));this.addWidget(t),this.addClass("jpcad-sidebar-treepanel")}}class H extends m.Component{constructor(e){var t,o;super(e),this.stateToTree=()=>this.state.jcadObject?this.state.jcadObject.map((e=>{var t;const o=e.name,s=[];return e.shape&&s.push({id:`${o}#shape#${e.shape}#${this.state.filePath}`,label:"Shape",parentId:o}),e.operators&&s.push({id:`${o}#operator#${this.state.filePath}`,label:"Operators",parentId:o}),{id:o,label:null!==(t=e.name)&&void 0!==t?t:`Object (#${o})`,parentId:null,items:s}})):[],this._handleThemeChange=()=>{const e="true"===document.body.getAttribute("data-jp-theme-light");this.setState((t=>Object.assign(Object.assign({},t),{lightTheme:e})))},this._sharedJcadModelChanged=(e,t)=>{t.objectChange&&this.setState((e=>{var t,o;return Object.assign(Object.assign({},e),{jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),options:null===(o=this.props.cpModel.sharedModel)||void 0===o?void 0:o.options})}))},this._onClientSharedStateChanged=(e,t)=>{var o,s,n;const i=null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.localState;if(!i)return;let a=[];if(i.remoteUser){const e=t.get(i.remoteUser);(null===(s=null==e?void 0:e.selected)||void 0===s?void 0:s.value)&&(a=e.selected.value)}else(null===(n=i.selected)||void 0===n?void 0:n.value)&&(a=i.selected.value);const d=[...this.state.openNodes];for(const e of a)e&&-1===d.indexOf(e)&&d.push(e);this.setState((e=>Object.assign(Object.assign({},e),{openNodes:d,selectedNodes:a})))},this._onClientSharedOptionsChanged=(e,t)=>{this.setState((t=>Object.assign(Object.assign({},t),{options:e.options})))};const s="true"===document.body.getAttribute("data-jp-theme-light");this.state={filePath:this.props.cpModel.filePath,jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),lightTheme:s,selectedNodes:[],clientId:null,id:(0,_.Z)(),openNodes:[]},null===(o=this.props.cpModel.jcadModel)||void 0===o||o.sharedObjectsChanged.connect(this._sharedJcadModelChanged),this.props.cpModel.documentChanged.connect(((e,t)=>{t?(this.props.cpModel.disconnect(this._sharedJcadModelChanged),this.props.cpModel.disconnect(this._handleThemeChange),this.props.cpModel.disconnect(this._onClientSharedStateChanged),t.context.model.sharedObjectsChanged.connect(this._sharedJcadModelChanged),t.context.model.themeChanged.connect(this._handleThemeChange),t.context.model.clientStateChanged.connect(this._onClientSharedStateChanged),t.context.model.sharedOptionsChanged.connect(this._onClientSharedOptionsChanged),this.setState((e=>{var o,s;return Object.assign(Object.assign({},e),{filePath:t.context.localPath,jcadObject:null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.getAllObject(),options:null===(s=this.props.cpModel.sharedModel)||void 0===s?void 0:s.options,clientId:t.context.model.getClientId()})}))):this.setState({filePath:void 0,jcadObject:void 0,jcadOption:void 0})}))}getObjectFromName(e){if(e&&this.state.jcadObject){const t=this.state.jcadObject.filter((t=>t.name===e));if(t.length>0)return t[0]}}render(){const{selectedNodes:e,openNodes:t,options:o}=this.state,s=this.stateToTree(),n=[];for(const t of e){const e=s.filter((e=>e.id===t));e.length>0&&e[0].items.length>0&&n.push(e[0].items[0].id)}return m.createElement("div",{className:"jpcad-treeview-wrapper"},m.createElement(V.v,{multiSelect:!0,nodes:s,openNodes:t,selectedNodes:n,messages:{noData:"No data"},theme:"labTheme",themes:W,onToggleSelectedNodes:e=>{var t,o;if(e!==n)if(e&&e.length>0){const o=[];for(const t of e){const e=t;e.includes("#")?o.push(e.split("#")[0]):o.push(e)}null===(t=this.props.cpModel.jcadModel)||void 0===t||t.syncSelectedObject(o,this.state.id)}else null===(o=this.props.cpModel.jcadModel)||void 0===o||o.syncSelectedObject([])},RenderNode:e=>{const t=this.getObjectFromName(e.node.parentId);let s=!0;return t&&(s=t.visible),t&&o&&o.guidata&&Object.prototype.hasOwnProperty.call(o.guidata,t.name)&&Object.prototype.hasOwnProperty.call(o.guidata[t.name],"visibility")&&(s=o.guidata[t.name].visibility),m.createElement("div",{className:"jpcad-control-panel-tree "+(e.selected?"selected":"")},m.createElement("div",{style:{paddingLeft:"5px",minHeight:"20px",display:"flex",alignItems:"center",justifyContent:"space-between",minWidth:0}},m.createElement("span",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflowX:"hidden"}},e.node.label),"leaf"===e.type?m.createElement("div",{style:{display:"flex"}},m.createElement(b.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:()=>{var t,o;const n=e.node.parentId,i=(null===(t=this.props.cpModel.sharedModel)||void 0===t?void 0:t.getOption("guidata"))||{objectId:{}};i&&(i[n]?i[n].visibility=!s:i[n]={visibility:!s}),null===(o=this.props.cpModel.sharedModel)||void 0===o||o.setOption("guidata",i)},icon:s?F:G}),m.createElement(b.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:()=>{var t,o;const s=e.node.parentId;null===(t=this.props.cpModel.jcadModel)||void 0===t||t.sharedModel.removeObjectByName(s),null===(o=this.props.cpModel.jcadModel)||void 0===o||o.syncSelectedObject([])},icon:b.closeIcon})):null))}}))}}class $ extends b.SidePanel{constructor(e){super(),this.addClass("jpcad-sidepanel-widget"),this._model=e.model,this._annotationModel=e.annotationModel;const t=new R;this.header.addWidget(t);const o=new U({controlPanelModel:this._model});this.addWidget(o);const s=new N({model:this._annotationModel});this.addWidget(s),e.tracker.currentChanged.connect(((o,s)=>{var n;s?(t.title.label=s.context.localPath,this._annotationModel.context=(null===(n=e.tracker.currentWidget)||void 0===n?void 0:n.context)||void 0):(t.title.label="-",this._annotationModel.context=void 0)}))}dispose(){super.dispose()}}class J{constructor(e){this._tracker=e.tracker,this._documentChanged=this._tracker.currentChanged}get documentChanged(){return this._documentChanged}get filePath(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.localPath}get jcadModel(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.model}get sharedModel(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.model.sharedModel}disconnect(e){this._tracker.forEach((t=>{t.context.model.sharedObjectsChanged.disconnect(e),t.context.model.sharedOptionsChanged.disconnect(e),t.context.model.sharedMetadataChanged.disconnect(e)})),this._tracker.forEach((t=>t.context.model.themeChanged.disconnect(e))),this._tracker.forEach((t=>t.context.model.clientStateChanged.disconnect(e)))}}var Z=o(62506);class Y extends b.PanelWithToolbar{constructor(e){super(e),this.title.label="Objects Properties";const t=g.ReactWidget.create(m.createElement(q,{cpModel:e.controlPanelModel}));this.addWidget(t),this.addClass("jpcad-sidebar-propertiespanel")}}class q extends m.Component{constructor(e){var t,o;super(e),this.syncSelectedField=(e,t,o)=>{var s;let n=null;if(e){const t=e.split("_")[0];n=e.substring(t.length)}null===(s=this.props.cpModel.jcadModel)||void 0===s||s.syncSelectedPropField({parentType:o,id:n,value:t})},this._sharedJcadModelChanged=(e,t)=>{this.setState((e=>{var t,o;if(e.selectedObject){const o=null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject();if(o){const t=(0,j.ro)(e.selectedObject,o);if(!t)return e;const s=t.parameters;return Object.assign(Object.assign({},e),{jcadObject:o,selectedObjectData:s})}return e}return Object.assign(Object.assign({},e),{jcadObject:null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.getAllObject()})}))},this._onClientSharedStateChanged=(e,t)=>{var o,s,n,i,a,d,l,r,c;const h=null===(s=null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.localState)||void 0===s?void 0:s.remoteUser,m=this.state.clientId;let p;if(h){p=t.get(h);const e=null===(n=null==p?void 0:p.selectedPropField)||void 0===n?void 0:n.id,o=null===(i=null==p?void 0:p.selectedPropField)||void 0===i?void 0:i.value;"panel"===(null===(a=null==p?void 0:p.selectedPropField)||void 0===a?void 0:a.parentType)&&(this._lastSelectedPropFieldId=(0,j.Dd)(`${this.state.filePath}::panel`,e,o,null===(d=null==p?void 0:p.user)||void 0===d?void 0:d.color,this._lastSelectedPropFieldId))}else{const e=m?t.get(m):null;this._lastSelectedPropFieldId&&((0,j.ef)(`${this.state.filePath}::panel`,this._lastSelectedPropFieldId,["border-color","box-shadow"]),this._lastSelectedPropFieldId=void 0),e&&(null===(l=e.selected)||void 0===l?void 0:l.emitter)&&e.selected.emitter!==this.state.id&&(null===(r=e.selected)||void 0===r?void 0:r.value)&&(p=e)}if(p){const e=""+p.selected.value;if(e!==this.state.selectedObject){if(0===e.length)return void this.setState((e=>Object.assign(Object.assign({},e),{schema:void 0,selectedObjectData:void 0})));const t=null===(c=this.props.cpModel.jcadModel)||void 0===c?void 0:c.getAllObject();if(t){let o;const s=(0,j.ro)(e,t);if(!s)return;s.shape&&(o=Z[s.shape]);const n=s.parameters;this.setState((t=>Object.assign(Object.assign({},t),{selectedObjectData:n,selectedObject:e,schema:o})))}}}},this.state={filePath:this.props.cpModel.filePath,jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),clientId:null,id:(0,_.Z)()},null===(o=this.props.cpModel.jcadModel)||void 0===o||o.sharedObjectsChanged.connect(this._sharedJcadModelChanged),this.props.cpModel.documentChanged.connect(((e,t)=>{t?(this.props.cpModel.disconnect(this._sharedJcadModelChanged),this.props.cpModel.disconnect(this._onClientSharedStateChanged),t.context.model.sharedObjectsChanged.connect(this._sharedJcadModelChanged),t.context.model.clientStateChanged.connect(this._onClientSharedStateChanged),this.setState((e=>{var o;return Object.assign(Object.assign({},e),{filePath:t.context.localPath,jcadObject:null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.getAllObject(),clientId:t.context.model.getClientId()})}))):this.setState({jcadOption:void 0,filePath:void 0,jcadObject:void 0,selectedObjectData:void 0,selectedObject:void 0,schema:void 0})}))}syncObjectProperties(e,t){var o;if(!this.state.jcadObject||!e)return;const s=null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.sharedModel,n=null==s?void 0:s.getObjectByName(e);s&&n&&s.updateObjectByName(e,"parameters",Object.assign(Object.assign({},n.parameters),t))}render(){return this.state.schema&&this.state.selectedObjectData?m.createElement(B.z,{parentType:"panel",filePath:`${this.state.filePath}::panel`,schema:this.state.schema,sourceData:this.state.selectedObjectData,syncData:e=>{this.syncObjectProperties(this.state.selectedObject,e)},syncSelectedField:this.syncSelectedField}):m.createElement("div",null)}}class K extends b.SidePanel{constructor(e){super(),this.addClass("jpcad-sidepanel-widget"),this._model=e.model;const t=new R;this.header.addWidget(t);const o=new Y({controlPanelModel:this._model});this.addWidget(o),this._model.documentChanged.connect(((e,o)=>{t.title.label=o?o.context.localPath:"-"}))}dispose(){super.dispose()}}var X=o(40448),Q=o(60565),ee=o(72195),te=o(35710),oe=o(50757);class se extends m.Component{constructor(e){super(e),this.selectUser=e=>{var t;let o;e.userId!==(null===(t=this.state.selectedUser)||void 0===t?void 0:t.userId)&&(o=e),this.setState((e=>Object.assign(Object.assign({},e),{selectedUser:o})),(()=>{this._model.setUserToFollow(null==o?void 0:o.userId)}))},this._model=e.model,this.state={usersList:[]}}componentDidMount(){this.setState((e=>Object.assign(Object.assign({},e),{usersList:this._model.users}))),this._model.userChanged.connect(((e,t)=>{this.setState((e=>Object.assign(Object.assign({},e),{usersList:t})))}))}createUserIcon(e){var t;let o;const{userId:s,userData:n}=e,i=s===(null===(t=this.state.selectedUser)||void 0===t?void 0:t.userId)?"selected":"";return o=n.avatar_url?m.createElement("div",{key:s,title:n.display_name,className:`lm-MenuBar-itemIcon jp-MenuBar-imageIcon ${i}`,onClick:()=>this.selectUser(e)},m.createElement("img",{src:n.avatar_url,alt:""})):m.createElement("div",{key:s,title:n.display_name,className:`lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon ${i}`,style:{backgroundColor:n.color},onClick:()=>this.selectUser(e)},m.createElement("span",null,n.initials)),o}render(){return m.createElement("div",{className:"jpcad-toolbar-usertoolbar"},this.state.usersList.map((e=>{if(e.userId!==this._model.currentUserId)return this.createUserIcon(e)})))}}const ne="jcad-Toolbar-Separator";class ie extends c.Widget{constructor(){super(),this.addClass(ne)}}class ae extends b.Toolbar{constructor(e){super(e),this.addClass("jpcad-toolbar-widget"),e.commands&&(this.addItem("undo",new g.CommandToolbarButton({id:d.T.undo,label:"",icon:b.undoIcon,commands:e.commands})),this.addItem("redo",new g.CommandToolbarButton({id:d.T.redo,label:"",icon:b.redoIcon,commands:e.commands})),this.addItem("separator1",new ie),this.addItem("New Box",new g.CommandToolbarButton({id:d.T.newBox,label:"",commands:e.commands})),this.addItem("New Cylinder",new g.CommandToolbarButton({id:d.T.newCylinder,label:"",commands:e.commands})),this.addItem("New Sphere",new g.CommandToolbarButton({id:d.T.newSphere,label:"",commands:e.commands})),this.addItem("New Cone",new g.CommandToolbarButton({id:d.T.newCone,label:"",commands:e.commands})),this.addItem("New Torus",new g.CommandToolbarButton({id:d.T.newTorus,label:"",commands:e.commands})),this.addItem("separator2",new ie),this.addItem("Cut",new g.CommandToolbarButton({id:d.T.cut,label:"",commands:e.commands})),this.addItem("Union",new g.CommandToolbarButton({id:d.T.union,label:"",commands:e.commands})),this.addItem("Intersection",new g.CommandToolbarButton({id:d.T.intersection,label:"",commands:e.commands})),this.addItem("Extrusion",new g.CommandToolbarButton({id:d.T.extrusion,label:"",commands:e.commands})),this.addItem("separator3",new ie),this.addItem("New Sketch",new g.CommandToolbarButton({id:d.T.newSketch,label:"",commands:e.commands})),this.addItem("separator4",new ie),this.addItem("Axes Helper",new g.CommandToolbarButton({id:d.T.updateAxes,label:"",commands:e.commands})),this.addItem("Exploded View",new g.CommandToolbarButton({id:d.T.updateExplodedView,label:"",commands:e.commands})),this.addItem("Camera Settings",new g.CommandToolbarButton({id:d.T.updateCameraSettings,label:"",commands:e.commands})),this.addItem("spacer",b.Toolbar.createSpacerItem()),this.addItem("users",b.ReactWidget.create(m.createElement(se,{model:e.model}))))}}class de{constructor(e){this._contextChanged=new T.Signal(this),this._updateSignal=new T.Signal(this),this.context=e.context}get updateSignal(){return this._updateSignal}get user(){return this._user}set context(e){var t;this._context=e;const o=null===(t=this._context)||void 0===t?void 0:t.model.sharedModel.awareness.getLocalState();this._user=null==o?void 0:o.user,this._contextChanged.emit(void 0)}get context(){return this._context}get contextChanged(){return this._contextChanged}update(){this._updateSignal.emit(null)}getAnnotation(e){var t;const o=null===(t=this._context)||void 0===t?void 0:t.model.sharedModel.getMetadata(e);if(o)return JSON.parse(o)}getAnnotationIds(){var e;const t=[];for(const o in null===(e=this._context)||void 0===e?void 0:e.model.sharedModel.metadata)o.startsWith("annotation")&&t.push(o);return t}addAnnotation(e,t){var o;null===(o=this._context)||void 0===o||o.model.sharedModel.setMetadata(`annotation_${e}`,JSON.stringify(t))}removeAnnotation(e){var t;null===(t=this._context)||void 0===t||t.model.removeMetadata(e)}addContent(e,t){var o;const s={value:t,user:this._user},n=this.getAnnotation(e);if(n){const t=Object.assign(Object.assign({},n),{contents:[...n.contents,s]});null===(o=this._context)||void 0===o||o.model.sharedModel.setMetadata(e,JSON.stringify(t))}}}}}]);