"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[465],{10465:(e,t,s)=>{s.r(t),s.d(t,{IAnnotationToken:()=>u,IJCadWorkerRegistryToken:()=>_,IJupyterCadDocTracker:()=>g,JupyterCadDoc:()=>p,JupyterCadModel:()=>c,JupyterCadStepDoc:()=>l});var a=s(43044),r=s(50558),i=s(53968),o=s(27991),n=s.n(o),d=s(70040);const h=JSON.parse('{"type":"object","title":"IJCadContent","required":["objects"],"additionalProperties":false,"properties":{"objects":{"$ref":"#/definitions/jcadModel"},"options":{"$ref":"#/definitions/jcadOptions"},"metadata":{"type":"object","patternProperties":{"^.*$":{"type":"string"}},"additionalProperties":false}},"definitions":{"parts":{"type":"string","enum":["Part::Any","Part::Box","Part::Cylinder","Part::Sphere","Part::Cone","Part::Torus","Part::Cut","Part::MultiFuse","Part::MultiCommon","Part::Extrusion","Sketcher::SketchObject"]},"shapeMetadata":{"title":"IShapeMetadata","type":"object","required":["mass","centerOfMass","matrixOfInertia"],"additionalProperties":false,"properties":{"mass":{"type":"number"},"centerOfMass":{"type":"array","items":{"type":"number"}},"matrixOfInertia":{"type":"array","items":{"type":"array","items":{"type":"number"}}}}},"jcadObject":{"title":"IJCadObject","type":"object","additionalProperties":false,"required":["name","visible"],"properties":{"name":{"type":"string"},"visible":{"type":"boolean"},"shape":{"$ref":"#/definitions/parts"},"parameters":{"type":"object"},"shapeMetadata":{"$ref":"#/definitions/shapeMetadata"},"operators":{"type":"array","items":{"type":"object"}},"dependencies":{"type":"array","items":{"type":"string"}}}},"jcadModel":{"title":"IJCadModel","type":"array","default":[],"items":{"$ref":"#/definitions/jcadObject"}},"jcadOptions":{"title":"IJCadOptions","type":"object","default":{},"additionalProperties":false,"properties":{"guidata":{"type":"object"}}}}}');class c{constructor(e){this.collaborative=!0,this._onClientStateChanged=e=>{const t=this.sharedModel.awareness.getStates();this._clientStateChanged.emit(t),this._sharedModel.awareness.on("change",(e=>{(e.added.length||e.removed.length)&&this._userChanged.emit(this.users)}))},this.defaultKernelName="",this.defaultKernelLanguage="",this._dirty=!1,this._readOnly=!1,this._isDisposed=!1,this._userChanged=new i.Signal(this),this._disposed=new i.Signal(this),this._contentChanged=new i.Signal(this),this._stateChanged=new i.Signal(this),this._themeChanged=new i.Signal(this),this._clientStateChanged=new i.Signal(this);const{annotationModel:t,sharedModel:s}=e;this._sharedModel=s||p.create(),this.sharedModel.awareness.on("change",this._onClientStateChanged),this.annotationModel=t}get sharedModel(){return this._sharedModel}get isDisposed(){return this._isDisposed}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get themeChanged(){return this._themeChanged}get currentUserId(){var e;return null===(e=this.sharedModel)||void 0===e?void 0:e.awareness.clientID}get users(){var e;this._usersMap=null===(e=this._sharedModel)||void 0===e?void 0:e.awareness.getStates();const t=[];return this._usersMap&&this._usersMap.forEach(((e,s)=>{t.push({userId:s,userData:e.user})})),t}get userChanged(){return this._userChanged}get dirty(){return this._dirty}set dirty(e){this._dirty=e}get readOnly(){return this._readOnly}set readOnly(e){this._readOnly=e}get localState(){return this.sharedModel.awareness.getLocalState()}get clientStateChanged(){return this._clientStateChanged}get sharedMetadataChanged(){return this.sharedModel.metadataChanged}get sharedOptionsChanged(){return this.sharedModel.optionsChanged}get sharedObjectsChanged(){return this.sharedModel.objectsChanged}get disposed(){return this._disposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._sharedModel.dispose(),this._disposed.emit(),i.Signal.clearData(this))}toString(){return JSON.stringify(this.getContent(),null,2)}fromString(e){const t=JSON.parse(e);if(!(new(n())).compile(h)(t))throw Error("File format error");this.sharedModel.transact((()=>{var e;this.sharedModel.addObjects(t.objects),this.sharedModel.setOptions(null!==(e=t.options)&&void 0!==e?e:{})}))}toJSON(){return JSON.parse(this.toString())}fromJSON(e){}initialize(){}getWorker(){return c.worker}getContent(){return{objects:this.sharedModel.objects,options:this.sharedModel.options}}getAllObject(){return this.sharedModel.objects}syncPointer(e,t){this.sharedModel.awareness.setLocalStateField("pointer",{value:e,emitter:t})}syncCamera(e,t){this.sharedModel.awareness.setLocalStateField("camera",{value:e,emitter:t})}syncSelectedObject(e,t){this.sharedModel.awareness.setLocalStateField("selected",{value:e,emitter:t})}syncSelectedPropField(e){this.sharedModel.awareness.setLocalStateField("selectedPropField",e)}setUserToFollow(e){this._sharedModel&&this._sharedModel.awareness.setLocalStateField("remoteUser",e)}syncFormData(e){this._sharedModel&&this._sharedModel.awareness.setLocalStateField("toolbarForm",e)}getClientId(){return this.sharedModel.awareness.clientID}addMetadata(e,t){this.sharedModel.setMetadata(e,t)}removeMetadata(e){this.sharedModel.removeMetadata(e)}}class p extends a.YDocument{constructor(){super(),this._objectsObserver=e=>{const t=[];let s=!1;e.forEach((e=>{const a=e.target.get("name");a&&e.keys.forEach(((i,o)=>{s||"shapeMetadata"===o||(s=!0),t.push({name:a,key:o,newValue:r.JSONExt.deepCopy(e.target.toJSON())})}))})),s=0===t.length||s,s&&this._objectsChanged.emit({objectChange:t}),this._changed.emit({objectChange:t})},this._metaObserver=e=>{this._metadataChanged.emit(e.keys)},this._optionsObserver=e=>{this._optionsChanged.emit(e.keys)},this._metadataChanged=new i.Signal(this),this._optionsChanged=new i.Signal(this),this._objectsChanged=new i.Signal(this),this._options=this.ydoc.getMap("options"),this._objects=this.ydoc.getArray("objects"),this._metadata=this.ydoc.getMap("metadata"),this.undoManager.addToScope(this._objects),this._objects.observeDeep(this._objectsObserver),this._metadata.observe(this._metaObserver),this._options.observe(this._optionsObserver)}dispose(){this._objects.unobserveDeep(this._objectsObserver),this._metadata.unobserve(this._metaObserver),this._options.unobserve(this._optionsObserver),super.dispose()}get version(){return"0.1.0"}get objects(){return this._objects.map((e=>r.JSONExt.deepCopy(e.toJSON())))}get options(){return r.JSONExt.deepCopy(this._options.toJSON())}get metadata(){return r.JSONExt.deepCopy(this._metadata.toJSON())}get objectsChanged(){return this._objectsChanged}get optionsChanged(){return this._optionsChanged}get metadataChanged(){return this._metadataChanged}objectExists(e){return Boolean(this._getObjectAsYMapByName(e))}getObjectByName(e){const t=this._getObjectAsYMapByName(e);if(t)return r.JSONExt.deepCopy(t.toJSON())}removeObjectByName(e){let t=0;for(const s of this._objects){if(s.get("name")===e)break;t++}this._objects.length>t&&this.transact((()=>{this._objects.delete(t);const s=this.getOption("guidata");s&&(delete s[e],this.setOption("guidata",s))}))}addObject(e){this.addObjects([e])}addObjects(e){this.transact((()=>{e.map((e=>{this.objectExists(e.name)?console.error("There is already an object with the name:",e.name):this._objects.push([new d.Map(Object.entries(e))])}))}))}updateObjectByName(e,t,s){const a=this._getObjectAsYMapByName(e);a&&this.transact((()=>a.set(t,s)))}getOption(e){const t=this._options.get(e);if(t)return r.JSONExt.deepCopy(t)}setOption(e,t){this.transact((()=>{this._options.set(e,t)}))}setOptions(e){this.transact((()=>{for(const[t,s]of Object.entries(e))this._options.set(t,s)}))}getMetadata(e){return this._metadata.get(e)}setMetadata(e,t){this.transact((()=>{this._metadata.set(e,t)}))}removeMetadata(e){this._metadata.has(e)&&this._metadata.delete(e)}setShapeMeta(e,t){const s=this._getObjectAsYMapByName(e);t&&s&&this.transact((()=>{s.set("shapeMetadata",t)}))}static create(){return new p}_getObjectAsYMapByName(e){for(const t of this._objects)if(t.get("name")===e)return t}}class l extends p{constructor(){super(),this._sourceObserver=e=>{const t=[];e.forEach((e=>{e.keys.forEach(((s,a)=>{t.push({name:"Step File",key:a,newValue:r.JSONExt.deepCopy(e.target.toJSON())})}))})),this._objectChanged.emit({objectChange:t}),this._changed.emit({objectChange:t})},this._objectChanged=new i.Signal(this),this._source=this.ydoc.getText("source"),this._source.observeDeep(this._sourceObserver)}get version(){return"0.1.0"}get objectsChanged(){return this._objectChanged}get objects(){return this._source.toJSON()?[{name:"Step File",visible:!0,shape:"Part::Any",parameters:{Content:this._source.toJSON(),Type:"STEP"}}]:[]}static create(){return new l}}const g=new r.Token("jupyterCadDocTracker"),u=new r.Token("jupytercadAnnotationModel"),_=new r.Token("jupytercadWorkerRegistry")}}]);