<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Console Applications &mdash; imagedata 3.2.4dev0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="Examples.html" />
    <link rel="prev" title="DICOM Attributes" href="DICOMAttributes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> imagedata
          </a>
              <div class="version">
                3.2.4dev0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="UserGuide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="Collections.html">Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="Notebook.html">Jupyter Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction.html">Motivation and goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction.html#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction.html#series-class">Series Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="Input_output.html">Input/output</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sorting.html">Sorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="DICOMAttributes.html">DICOM Attributes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Console Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#included-console-applications">Included console applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dicom-dump">dicom_dump</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-calculator">image_calculator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-data">image_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-list">image_list</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-show">image_show</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-statistics">image_statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeline">timeline</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#write-your-own-console-applications">Write your own console applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plugins.html">Plugin Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="APIReference.html">API Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DeveloperDocumentation.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">imagedata</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="UserGuide.html">User Guide</a> &raquo;</li>
      <li>Console Applications</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/CommandLine.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="console-applications">
<span id="commandline"></span><h1>Console Applications<a class="headerlink" href="#console-applications" title="Permalink to this headline"></a></h1>
<div class="section" id="included-console-applications">
<h2>Included console applications<a class="headerlink" href="#included-console-applications" title="Permalink to this headline"></a></h2>
<div class="section" id="dicom-dump">
<h3>dicom_dump<a class="headerlink" href="#dicom-dump" title="Permalink to this headline"></a></h3>
<p>Scan folders of DICOM files, and report the structure.
Can be handy when the sorting of the images is unclear.</p>
<p>Example of output on a MR diffusion-weighted acquisition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">dicom_dump</span> <span class="o">./</span><span class="n">EP2D_DIFF_B50_400_800_TRA_P2_TRACEW_DFC_MIX_0007</span>
<span class="n">StuInsUID</span> <span class="mf">1.2</span><span class="o">.</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">30000019020708423676500000016</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
<span class="n">SerInsUID</span> <span class="mf">1.2</span><span class="o">.</span><span class="mf">3.4</span><span class="o">.</span><span class="mf">2019020714224132517098797.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
<span class="n">SerTim</span> <span class="mf">142629.896000</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
<span class="n">SeqNam</span> <span class="o">*</span><span class="n">ep_b50t</span><span class="p">:</span> <span class="mi">30</span> <span class="n">images</span>
<span class="n">SeqNam</span> <span class="o">*</span><span class="n">ep_b400t</span><span class="p">:</span> <span class="mi">30</span> <span class="n">images</span>
<span class="n">SeqNam</span> <span class="o">*</span><span class="n">ep_b800t</span><span class="p">:</span> <span class="mi">30</span> <span class="n">images</span>
<span class="n">AcqNum</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
<span class="n">ImaTyp</span> <span class="n">DERIVED</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
<span class="n">Echo</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span>
</pre></div>
</div>
</div>
<div class="section" id="image-calculator">
<h3>image_calculator<a class="headerlink" href="#image-calculator" title="Permalink to this headline"></a></h3>
<p>Calculate a new series based on existing series.</p>
<dl class="simple">
<dt>Usage:</dt><dd><p>image_calculator &lt;output&gt; &lt;expression&gt; &lt;inputs&gt;</p>
</dd>
</dl>
<p>The inputs will be assigned variables a, b, c, <em>etc.</em>
The expression, like ‘a+b’, should result in a new series of similar
size as ‘a’.
This series will be saved in the &lt;output&gt;.
The calculator can do simple math and np (NumPy) operations, as long
as the resulting image has a shape compatible with ‘a’.</p>
<p>DICOM series typically result in uint16 data. To perform the calculation in
floating point, include option ‘--dtype float64’.</p>
<p>Example calculating mean of three series. The input data are converted to float64:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_calculator</span> <span class="o">--</span><span class="n">serdes</span> <span class="s1">&#39;Mean T1_VIBE_FLIP&#39;</span> <span class="o">--</span><span class="n">dtype</span> <span class="n">float64</span> \
    <span class="n">mean</span> <span class="s1">&#39;(a+b+c)/3&#39;</span> <span class="n">T1_VIBE_FLIP</span><span class="o">*</span>
<span class="n">Converting</span> <span class="nb">input</span><span class="o">...</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">T1_VIBE_FLIP18_0013</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">float64</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">T1_VIBE_FLIP3_0011</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">float64</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">T1_VIBE_FLIP8_0012</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">float64</span>
<span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">float64</span>
</pre></div>
</div>
<p>Example creating a mask=1 of equal size to input data. Notice the
input data is only used to give matrix dimensions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_calculator</span> <span class="n">mask</span> <span class="s1">&#39;1&#39;</span> <span class="n">T1_VIBE_FLIP8_0012</span><span class="o">/</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">T1_VIBE_FLIP8_0012</span><span class="o">/</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">uint16</span>
<span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span> <span class="n">uint16</span>
</pre></div>
</div>
<p>Example creating a mask = np.eye(128). Notice there is no input data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_calculator</span> <span class="n">eye</span> <span class="s1">&#39;Series(np.eye(128))&#39;</span>
<span class="n">eye</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="n">float64</span>
</pre></div>
</div>
<p>By default, np.eye() will produce float64 data as above. There are three methods to set the output to uint16:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_calculator</span> <span class="n">eye</span> <span class="s1">&#39;Series(np.eye(128, dtype=np.uint16))&#39;</span>
<span class="n">eye</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">))</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="n">uint16</span>

<span class="o">%</span> <span class="n">image_calculator</span> <span class="o">--</span><span class="n">dtype</span> <span class="n">uint16</span> <span class="n">eye</span> <span class="s1">&#39;Series(np.eye(128))&#39;</span>
<span class="n">eye</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="n">float64</span>
</pre></div>
</div>
<p>In the latter case, the output float64 data is converted to uint16 when writing the output.</p>
<p>An existing DICOM object can be used as template to set DICOM attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_calculator</span> <span class="o">--</span><span class="n">template</span> <span class="n">dicom</span><span class="o">/</span><span class="nb">input</span> <span class="o">--</span><span class="n">geometry</span> <span class="n">dicom</span><span class="o">/</span><span class="nb">input</span> <span class="n">eye</span> <span class="s1">&#39;Series(np.eye(128))&#39;</span>
<span class="n">eye</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="image-data">
<h3>image_data<a class="headerlink" href="#image-data" title="Permalink to this headline"></a></h3>
<p>Convert input to output data, possible modifying the image format. The input data can be a cohort of series,
study and patients. The output will be sorted in folders with appropriate names.</p>
<dl>
<dt>Usage:</dt><dd><p>image_data [&lt;options&gt;] &lt;output&gt; &lt;input list…&gt;</p>
</dd>
<dt>Some options:</dt><dd><p>--of &lt;output format&gt;: Possible output format: dicom, itk, nifti, mat (default: dicom). Can be repeated.</p>
<p>--order &lt;input order&gt;: How to sort input files: time, b, fa, te (default: ‘none’).</p>
<p>--dtype &lt;dtype&gt;: Specify output datatype. Otherwise keep input datatype. Dtypes: uint8, uint16, int16, int, float, float32, float64, double.</p>
<p>--template &lt;template&gt;: Source to get DICOM template from.</p>
<p>--geometry &lt;template&gt;: Second DICOM template for geometry attributes.</p>
<p>--sernum &lt;number&gt;: Set DICOM series number.</p>
<p>--serdes &lt;string&gt;: Set DICOM series description.</p>
<p>--imagetype: Set DICOM imagetype, comma-separated. <em>E.g.</em> ‘DERIVED,SECONDARY,MASK’</p>
</dd>
</dl>
<p>See “imagedata --help” for other options.</p>
<p>Example:
First a DICOM volume is converted to ITK MetaImage.
Next, the ITK MetaImage is read, adding DICOM attributes from the original
DICOM volume.
After setting series number and description, the images are sent to PACS
using the DICOM protocol.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert dicom/volume to itk/Image.mha</span>
<span class="c1">#                   Output        Input</span>
image_data --of itk itk/Image.mha dicom/volume

<span class="c1"># Convert itk/Image.mha to dicom using original data as template</span>
<span class="c1"># Send to DICOM store</span>
image_data --of dicom <span class="se">\</span>
    --template dicom/volume <span class="se">\</span>
    --sernum <span class="m">1000</span> <span class="se">\</span>
    --serdes <span class="s1">&#39;Series description&#39;</span> <span class="se">\</span>
    --imagetype <span class="s1">&#39;DERIVED,SECONDARY,MASK&#39;</span> <span class="se">\</span>
    dicom://server:104/AETITLE <span class="c1"># Output destination \</span>
    itk/Image.mha              <span class="c1"># Input data</span>
</pre></div>
</div>
</div>
<div class="section" id="image-list">
<h3>image_list<a class="headerlink" href="#image-list" title="Permalink to this headline"></a></h3>
<p>List available data on URL.</p>
<p>Example, recursive list on xnat-server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">image_list</span> <span class="o">-</span><span class="n">r</span> <span class="n">xnat</span><span class="p">:</span><span class="o">//</span><span class="n">xnat</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">Project</span><span class="o">/</span><span class="n">Subject</span><span class="o">/</span><span class="n">Experiment</span>
</pre></div>
</div>
</div>
<div class="section" id="image-show">
<h3>image_show<a class="headerlink" href="#image-show" title="Permalink to this headline"></a></h3>
<p>Display an image stack interactively.</p>
<dl class="simple">
<dt>Some options:</dt><dd><p>--order &lt;input order&gt;: How to sort input files (time, b, fa, te) (default: ‘none’).</p>
</dd>
</dl>
<p>The following controls can be used to manipulate the viewer:</p>
<ul class="simple">
<li><p>Mouse scroll wheel: scroll through the slices of a volume</p></li>
<li><p>Array up/down: scroll through the slices of a volume</p></li>
<li><p>Array left/right: step through the 4th dimension of a 4D dataset</p></li>
<li><p>PgUp/PgDown: Page through datasets when there are more datasets than views</p></li>
<li><p>Left mouse key pressed: adjust window/level of display</p></li>
<li><p>Mouse over: will display 2D coordinate and signal intensity at mouse position</p></li>
<li><p>‘q’: Quit. Will end the console application.</p></li>
</ul>
</div>
<div class="section" id="image-statistics">
<h3>image_statistics<a class="headerlink" href="#image-statistics" title="Permalink to this headline"></a></h3>
<p>Describe series shape, dtype, min, max and mean.
The input data can be a cohort of series, study and patients.
The output will report on series parameters for each patient, study and series.</p>
</div>
<div class="section" id="timeline">
<h3>timeline<a class="headerlink" href="#timeline" title="Permalink to this headline"></a></h3>
<p>Print timeline for a dynamic acquisition</p>
</div>
</div>
<div class="section" id="write-your-own-console-applications">
<h2>Write your own console applications<a class="headerlink" href="#write-your-own-console-applications" title="Permalink to this headline"></a></h2>
<p>A command line program can be as simple as copying input to output,
selecting input and output formats by command line options.
See Figure for an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">imagedata.cmdline</span>
<span class="kn">from</span> <span class="nn">imagedata</span> <span class="kn">import</span> <span class="n">Series</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">imagedata</span><span class="o">.</span><span class="n">cmdline</span><span class="o">.</span><span class="n">add_argparse_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;out_name&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output URL&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;in_dirs&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Input URL&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">in_dirs</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not read </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">’.format(args.in_dirs, e))</span>

    <span class="n">si</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">out_name</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>This python script can be called from the command line to convert and
transport images.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DICOMAttributes.html" class="btn btn-neutral float-left" title="DICOM Attributes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2023, Erling Andersen, Haukeland University Hospital, Bergen, Norway.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>