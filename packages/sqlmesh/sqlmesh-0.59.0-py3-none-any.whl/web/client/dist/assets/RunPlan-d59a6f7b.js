import{r as f,v as q,D as z,y as _,w as me,x as R,R as X,z as pe,A as se,B as O,X as B,I as J,F as ie,G as fe,H as xe,J as K,K as ve,T as he,M as y,Q as ge,U as H,V as ye,W as Z,Y as le,Z as be,u as oe,$ as M,a as I,a0 as Ie,o as P,j as t,d as j,a1 as L,a2 as $,c as D,S as ce,e as A,a3 as we,a4 as ue,a5 as ee,a6 as V,a7 as Ee,k as Re,a8 as je,E as Pe}from"./index-6baea4b4.js";import{C as Ne,I as te}from"./SearchList-014c5d81.js";import{F as Se,E as k,C as ke,P as ne}from"./PlanChangePreview-621a0413.js";import{c as De,d as Me,e as N,x as Ce}from"./context-19a622d4.js";import{s as Ae,k as ae}from"./popover-7a5b467a.js";import{M as Fe}from"./disclosure-1f7e3e09.js";import"./ModelLineage-4f4d45c4.js";import"./PlusIcon-bfa25c42.js";import"./_commonjs-dynamic-modules-302442b1.js";function Te({title:e,titleId:n,...i},r){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":n},i),e?f.createElement("title",{id:n},e):null,f.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const $e=f.forwardRef(Te),Oe=$e;var Le=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Le||{}),ze=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(ze||{}),_e=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(_e||{});function G(e,n=i=>i){let i=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,r=be(n(e.items.slice()),d=>d.dataRef.current.domRef.current),o=i?r.indexOf(i):null;return o===-1&&(o=null),{items:r,activeItemIndex:o}}let Be={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,n)=>{var i;let r=G(e),o=Ce(n,{resolveItems:()=>r.items,resolveActiveIndex:()=>r.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...e,...r,searchQuery:"",activeItemIndex:o,activationTrigger:(i=n.trigger)!=null?i:1}},3:(e,n)=>{let i=e.searchQuery!==""?0:1,r=e.searchQuery+n.value.toLowerCase(),o=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+i).concat(e.items.slice(0,e.activeItemIndex+i)):e.items).find(u=>{var a;return((a=u.dataRef.current.textValue)==null?void 0:a.startsWith(r))&&!u.dataRef.current.disabled}),d=o?e.items.indexOf(o):-1;return d===-1||d===e.activeItemIndex?{...e,searchQuery:r}:{...e,searchQuery:r,activeItemIndex:d,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,n)=>{let i=G(e,r=>[...r,{id:n.id,dataRef:n.dataRef}]);return{...e,...i}},6:(e,n)=>{let i=G(e,r=>{let o=r.findIndex(d=>d.id===n.id);return o!==-1&&r.splice(o,1),r});return{...e,...i,activationTrigger:1}}},W=f.createContext(null);W.displayName="MenuContext";function Q(e){let n=f.useContext(W);if(n===null){let i=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,Q),i}return n}function Qe(e,n){return se(n.type,Be,e,n)}let Ue=f.Fragment;function Ke(e,n){let{__demoMode:i=!1,...r}=e,o=f.useReducer(Qe,{__demoMode:i,menuState:i?0:1,buttonRef:f.createRef(),itemsRef:f.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:d,itemsRef:u,buttonRef:a},s]=o,h=_(n);me([a,u],(w,E)=>{var c;s({type:1}),ve(E,he.Loose)||(w.preventDefault(),(c=a.current)==null||c.focus())},d===0);let g=R(()=>{s({type:1})}),x=f.useMemo(()=>({open:d===0,close:g}),[d,g]),v={ref:h};return X.createElement(W.Provider,{value:o},X.createElement(pe,{value:se(d,{0:O.Open,1:O.Closed})},B({ourProps:v,theirProps:r,slot:x,defaultTag:Ue,name:"Menu"})))}let Ve="button";function Ge(e,n){var i;let r=J(),{id:o=`headlessui-menu-button-${r}`,...d}=e,[u,a]=Q("Menu.Button"),s=_(u.buttonRef,n),h=ie(),g=R(c=>{switch(c.key){case y.Space:case y.Enter:case y.ArrowDown:c.preventDefault(),c.stopPropagation(),a({type:0}),h.nextFrame(()=>a({type:2,focus:N.First}));break;case y.ArrowUp:c.preventDefault(),c.stopPropagation(),a({type:0}),h.nextFrame(()=>a({type:2,focus:N.Last}));break}}),x=R(c=>{switch(c.key){case y.Space:c.preventDefault();break}}),v=R(c=>{if(ge(c.currentTarget))return c.preventDefault();e.disabled||(u.menuState===0?(a({type:1}),h.nextFrame(()=>{var m;return(m=u.buttonRef.current)==null?void 0:m.focus({preventScroll:!0})})):(c.preventDefault(),a({type:0})))}),w=f.useMemo(()=>({open:u.menuState===0}),[u]),E={ref:s,id:o,type:Ae(e,u.buttonRef),"aria-haspopup":"menu","aria-controls":(i=u.itemsRef.current)==null?void 0:i.id,"aria-expanded":u.menuState===0,onKeyDown:g,onKeyUp:x,onClick:v};return B({ourProps:E,theirProps:d,slot:w,defaultTag:Ve,name:"Menu.Button"})}let He="div",Je=q.RenderStrategy|q.Static;function We(e,n){var i,r;let o=J(),{id:d=`headlessui-menu-items-${o}`,...u}=e,[a,s]=Q("Menu.Items"),h=_(a.itemsRef,n),g=fe(a.itemsRef),x=ie(),v=xe(),w=(()=>v!==null?(v&O.Open)===O.Open:a.menuState===0)();f.useEffect(()=>{let l=a.itemsRef.current;l&&a.menuState===0&&l!==(g==null?void 0:g.activeElement)&&l.focus({preventScroll:!0})},[a.menuState,a.itemsRef,g]),Se({container:a.itemsRef.current,enabled:a.menuState===0,accept(l){return l.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:l.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(l){l.setAttribute("role","none")}});let E=R(l=>{var p,C;switch(x.dispose(),l.key){case y.Space:if(a.searchQuery!=="")return l.preventDefault(),l.stopPropagation(),s({type:3,value:l.key});case y.Enter:if(l.preventDefault(),l.stopPropagation(),s({type:1}),a.activeItemIndex!==null){let{dataRef:b}=a.items[a.activeItemIndex];(C=(p=b.current)==null?void 0:p.domRef.current)==null||C.click()}le(a.buttonRef.current);break;case y.ArrowDown:return l.preventDefault(),l.stopPropagation(),s({type:2,focus:N.Next});case y.ArrowUp:return l.preventDefault(),l.stopPropagation(),s({type:2,focus:N.Previous});case y.Home:case y.PageUp:return l.preventDefault(),l.stopPropagation(),s({type:2,focus:N.First});case y.End:case y.PageDown:return l.preventDefault(),l.stopPropagation(),s({type:2,focus:N.Last});case y.Escape:l.preventDefault(),l.stopPropagation(),s({type:1}),H().nextFrame(()=>{var b;return(b=a.buttonRef.current)==null?void 0:b.focus({preventScroll:!0})});break;case y.Tab:l.preventDefault(),l.stopPropagation(),s({type:1}),H().nextFrame(()=>{ye(a.buttonRef.current,l.shiftKey?Z.Previous:Z.Next)});break;default:l.key.length===1&&(s({type:3,value:l.key}),x.setTimeout(()=>s({type:4}),350));break}}),c=R(l=>{switch(l.key){case y.Space:l.preventDefault();break}}),m=f.useMemo(()=>({open:a.menuState===0}),[a]),S={"aria-activedescendant":a.activeItemIndex===null||(i=a.items[a.activeItemIndex])==null?void 0:i.id,"aria-labelledby":(r=a.buttonRef.current)==null?void 0:r.id,id:d,onKeyDown:E,onKeyUp:c,role:"menu",tabIndex:0,ref:h};return B({ourProps:S,theirProps:u,slot:m,defaultTag:He,features:Je,visible:w,name:"Menu.Items"})}let Ye=f.Fragment;function qe(e,n){let i=J(),{id:r=`headlessui-menu-item-${i}`,disabled:o=!1,...d}=e,[u,a]=Q("Menu.Item"),s=u.activeItemIndex!==null?u.items[u.activeItemIndex].id===r:!1,h=f.useRef(null),g=_(n,h);K(()=>{if(u.__demoMode||u.menuState!==0||!s||u.activationTrigger===0)return;let b=H();return b.requestAnimationFrame(()=>{var U,Y;(Y=(U=h.current)==null?void 0:U.scrollIntoView)==null||Y.call(U,{block:"nearest"})}),b.dispose},[u.__demoMode,h,s,u.menuState,u.activationTrigger,u.activeItemIndex]);let x=De(h),v=f.useRef({disabled:o,domRef:h,get textValue(){return x()}});K(()=>{v.current.disabled=o},[v,o]),K(()=>(a({type:5,id:r,dataRef:v}),()=>a({type:6,id:r})),[v,r]);let w=R(()=>{a({type:1})}),E=R(b=>{if(o)return b.preventDefault();a({type:1}),le(u.buttonRef.current)}),c=R(()=>{if(o)return a({type:2,focus:N.Nothing});a({type:2,focus:N.Specific,id:r})}),m=Me(),S=R(b=>m.update(b)),l=R(b=>{m.wasMoved(b)&&(o||s||a({type:2,focus:N.Specific,id:r,trigger:0}))}),p=R(b=>{m.wasMoved(b)&&(o||s&&a({type:2,focus:N.Nothing}))}),C=f.useMemo(()=>({active:s,disabled:o,close:w}),[s,o,w]);return B({ourProps:{id:r,ref:g,role:"menuitem",tabIndex:o===!0?void 0:-1,"aria-disabled":o===!0?!0:void 0,disabled:void 0,onClick:E,onFocus:c,onPointerEnter:S,onMouseEnter:S,onPointerMove:l,onMouseMove:l,onPointerLeave:p,onMouseLeave:p},theirProps:d,slot:C,defaultTag:Ye,name:"Menu.Item"})}let Xe=z(Ke),Ze=z(Ge),et=z(We),tt=z(qe),F=Object.assign(Xe,{Button:Ze,Items:et,Item:tt});function pt(){const{setIsPlanOpen:e}=oe(),n=M(p=>p.planOverview),i=M(p=>p.planApply),r=M(p=>p.setPlanOverview),o=M(p=>p.setPlanApply),d=I(p=>p.isRunningPlan),u=I(p=>p.addConfirmation),a=I(p=>p.setShowConfirmation),s=I(p=>p.environment),h=I(p=>p.environments),g=I(p=>p.hasSynchronizedEnvironments),[x,v]=f.useState(!1),{refetch:w,isFetching:E}=Ie(s.name,{planOptions:{skip_tests:!0,include_unmodified:!0}});f.useEffect(()=>{x&&(c(),v(!1)),!P(s.isSynchronized)&&w()},[s]);function c(){e(!0),n.reset(),i.reset(),r(n),o(i)}const S=(P(s.isDefault)||g())&&(P(s.isDefault)||P(s.isInitial)),l=E||n.isRunning||i.isRunning;return t.jsxs("div",{className:j("flex items-center",Re(s)&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(L,{className:j("mx-0",P(s.isInitial&&s.isDefault)&&"rounded-none rounded-l-lg border-r"),variant:$.Alternative,size:D.sm,onClick:p=>{p.stopPropagation(),d?e(!0):s.isDefault&&P(s.isInitial)?u({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${s.name}`,noText:"No, Cancel",action(){c()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${h.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[h.size>1&&t.jsx(re,{className:"mr-2",side:"left",environment:s,showAddEnvironment:!1,onSelect:()=>{v(!0),a(!1)},size:D.md,disabled:l}),t.jsx(de,{className:"w-full",size:D.md,onAdd:()=>{v(!0),a(!1)}})]})]})}):c()},children:[d&&t.jsx(ce,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:at(n,i)})]}),S&&t.jsx(re,{className:"rounded-none rounded-r-lg border-l mx-0",environment:s,disabled:l})]}),t.jsx(nt,{environment:s,isRunningPlanOverview:E||n.isRunning,isRunningPlanApply:i.isRunning})]})}function nt({environment:e,isRunningPlanOverview:n,isRunningPlanApply:i}){var o,d,u,a;const r=M(s=>s.planOverview);return t.jsx("span",{className:"flex align-center h-full w-full",children:t.jsx(t.Fragment,{children:n?t.jsxs("span",{className:"flex items-center ml-2",children:[t.jsx(ce,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}):t.jsxs(t.Fragment,{children:[e.isInitial&&e.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),r.isLatest&&[n,i,e.isLocal].every(P)&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:t.jsx("span",{children:"Latest"})}),A(r.added)&&t.jsx(T,{headline:"Added Models",type:k.Add,changes:r.added??[]}),A((o=r.modified)==null?void 0:o.direct)&&t.jsx(T,{headline:"Direct Changes",type:k.Direct,changes:((d=r.modified)==null?void 0:d.direct.map(({model_name:s})=>s))??[]}),A((u=r.modified)==null?void 0:u.indirect)&&t.jsx(T,{headline:"Indirectly Modified",type:k.Indirect,changes:((a=r.modified)==null?void 0:a.indirect.map(({model_name:s})=>s))??[]}),A(r.removed)&&t.jsx(T,{headline:"Removed Models",type:k.Remove,changes:r.removed??[]})]})})})}function re({onSelect:e,environment:n,disabled:i,side:r=V.Right,className:o,showAddEnvironment:d=!0,size:u=D.sm}){const{addError:a}=oe(),s=I(c=>c.environments),h=I(c=>c.pinnedEnvironments),g=I(c=>c.defaultEnvironment),x=I(c=>c.setEnvironment),v=I(c=>c.removeLocalEnvironment),w=we(F.Button);function E(c){je(c.name).then(()=>{v(c)}).catch(m=>{a(Pe.Environments,m)})}return t.jsx(F,{children:({close:c})=>t.jsxs(t.Fragment,{children:[t.jsxs(w,{variant:$.Alternative,size:u,disabled:i,className:j(o),children:[t.jsx("span",{className:j("block overflow-hidden truncate",(n.isLocal||i)&&"text-neutral-500",n.isSynchronized&&"text-primary-500"),children:n.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Ne,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(ue,{as:f.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:j("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",r===V.Left&&"left-0",r===V.Right&&"right-0"),children:[t.jsxs(F.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(s).map(m=>t.jsx(F.Item,{children:({active:S})=>t.jsxs("div",{onClick:l=>{l.stopPropagation(),x(m),e==null||e()},className:j("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",S&&"bg-primary-10",m===n&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(ke,{className:j("w-4 h-4 text-primary-500 mt-1.5",S&&"opacity-10",m!==n&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:j("block truncate ml-2",m.isSynchronized&&"text-primary-500"),children:m.name}),t.jsxs("small",{className:"block ml-2",children:["(",m.type,")"]})]}),m.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Main Environment"})}),g===m&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[m.isPinned&&t.jsx(Oe,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),m.isLocal&&P(m.isPinned)&&m!==n&&t.jsx(L,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:D.xs,variant:$.Neutral,onClick:l=>{l.stopPropagation(),v(m)},children:t.jsx(Fe,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),P(m.isDefault)&&m!==n&&m.isSynchronized&&P(h.includes(m))&&t.jsx(L,{className:"!px-2 !my-0",size:D.xs,variant:$.Danger,onClick:l=>{l.stopPropagation(),E(m)},children:"Delete"})]})]})},m.name)),d&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(de,{onAdd:c,className:"mt-2 px-2"})]})]}),t.jsx(ee,{})]})})]})})}function de({onAdd:e,className:n,label:i="Add",size:r=D.sm}){const o=I(x=>x.getNextEnvironment),d=I(x=>x.isExistingEnvironment),u=I(x=>x.addLocalEnvironment),[a,s]=f.useState(""),[h,g]=f.useState(o().name);return t.jsxs("div",{className:j("flex w-full items-center",n),children:[t.jsx(te,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:r,children:({className:x})=>t.jsx(te.Textfield,{className:j(x,"w-full"),placeholder:"Environment",value:a,onInput:v=>{v.stopPropagation(),s(v.target.value)}})}),t.jsx(L,{className:"my-0 mx-0 font-bold",size:r,disabled:Ee(a)||d(a),onClick:x=>{x.stopPropagation(),u(a,h),s(""),g(o().name),e==null||e()},children:i})]})}function T({headline:e,type:n,changes:i}){const[r,o]=f.useState(!1);return t.jsx(ae,{onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:j("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",n===k.Add&&"bg-success-500 border-success-500",n===k.Remove&&"bg-danger-500 border-danger-500",n===k.Direct&&"bg-secondary-500 border-secondary-500",n===k.Indirect&&"bg-warning-500 border-warning-500",n===k.Default&&"bg-neutral-500 border-neutral-500"),children:i.length}),t.jsx(ue,{show:r,as:f.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(ne,{headline:e,type:n,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(ne.Default,{type:n,changes:i})})})})]})})}function at(e,n){return n.isRunning?"Applying Plan...":e.isRunning?"Getting Changes...":"Plan"}export{pt as default};
