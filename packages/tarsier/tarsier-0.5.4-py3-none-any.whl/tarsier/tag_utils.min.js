"use strict";const tarsierId="__tarsier_id",tarsierSelector=`#${tarsierId}`,elIsClean=t=>{const i=t.getBoundingClientRect(),s=window.getComputedStyle(t),n=s.visibility==="hidden"||s.display==="none"||t.hidden||t.disabled,a=s.opacity==="0",e=i.width===0||i.height===0,o=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!n&&!a&&!e&&!o},inputs=["a","button","textarea","select","details","label"],isInteractable=t=>inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=t=>{const i=t.tagName.toLowerCase();if(emptyTagWhitelist.includes(i))return!1;if("innerText"in t&&t.innerText.trim().length===0){const s=t.querySelector("svg"),n=t.querySelector("img");return s||n?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const i=t.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementXPath(t){let i=[],s="";for(t&&t.ownerDocument!==window.document&&(s=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let n=t.tagName.toLowerCase(),a=1,e=t.previousElementSibling;for(;e;)e.tagName===t.tagName&&a++,e=e.previousElementSibling;let o=t.nextElementSibling,r=!1;for(;o;){if(o.tagName===t.tagName){r=!0;break}o=o.nextElementSibling}if((a>1||r)&&(n+=`[${a}]`),t.id)return n+=`[@id="${t.id}"]`,i.unshift(n),"//"+i.join("/");if(t.className){const l=Array.from(t.classList).map(d=>`contains(concat(" ", normalize-space(@class), " "), " ${d} ")`).join(" and ");l.length>0&&(n+=`[${l}]`)}i.unshift(n),t=t.parentNode}return s+"//"+i.join("/")}function create_tagged_span(t,i){let s;isInteractable(i)?isTextInsertable(i)?s=`[#${t}]`:i.tagName.toLowerCase()=="a"?s=`[@${t}]`:s=`[$${t}]`:s=`[${t}]`;let n=document.createElement("span");return n.id=tarsierId,n.style.display="inline",n.style.color="white",n.style.backgroundColor="red",n.style.padding="3px",n.style.borderRadius="5px",n.style.margin="5px",n.style.zIndex="2140000046",n.style.clip="auto",n.style.height="fit-content",n.style.width="fit-content",n.textContent=s,n}window.tagifyWebpage=(t=!1)=>{window.removeTags();let i=0,s={},n=[...document.body.querySelectorAll("*")];const a=document.getElementsByTagName("iframe");for(let e=0;e<a.length;e++)try{const o=a[e];console.log("iframe!",a[e]);const c=[...(o.contentDocument||o.contentWindow?.document).querySelectorAll("*")];c.forEach(l=>l.setAttribute("iframe_index",e)),n.push(...c)}catch(o){console.error("Cross-origin iframe:",o)}n.map(e=>{isInteractable(e)&&e.childNodes.forEach(o=>{const r=n.indexOf(o);r>-1&&n.splice(r,1)})});for(let e of n)if(!(isEmpty(e)||!elIsClean(e))){if(s[i]=getElementXPath(e),isInteractable(e))i++;else if(t)for(let o of Array.from(e.childNodes))o.nodeType===Node.TEXT_NODE&&/\S/.test(o.textContent||"")&&i++}i=0;for(let e of n){if(isEmpty(e)||!elIsClean(e))continue;let o=create_tagged_span(i,e);if(isInteractable(e))isTextInsertable(e)&&e.parentElement?e.parentElement.insertBefore(o,e):e.prepend(o),i++;else if(t){for(let r of Array.from(e.childNodes))if(r.nodeType===Node.TEXT_NODE&&/\S/.test(r.textContent||"")){let c=create_tagged_span(i,e);e.insertBefore(c,r),i++}}}return absolutelyPositionMissingTags(),s};function absolutelyPositionMissingTags(){document.querySelectorAll(tarsierSelector).forEach(n=>{const a=n.parentElement,e=a.getBoundingClientRect(),o={x:(e.left+e.right)/2,y:(e.top+e.bottom)/2},r=n.getBoundingClientRect(),c={x:(r.left+r.right)/2,y:(r.top+r.bottom)/2},l=Math.abs(o.x-c.x),d=Math.abs(o.y-c.y);(l>500||d>500||!elIsClean(n))&&(n.style.position="absolute",n.style.left=`${e.left-20}px`,n.style.top=`${e.top-20}px`,a.removeChild(n),document.body.appendChild(n))})}window.removeTags=()=>{document.querySelectorAll(tarsierSelector).forEach(i=>i.remove())};
