"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{91173:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return RunRoot},default:function(){return eE}});var i=t(73235),o=t(52322),r=t(40794),s=t(60138),l=t(18399),a=t(17131),u=t(81308),c=t(3842),d=t(57830),p=t(92364),m=t(2784),x=t(7267),h=t(68028),f=t(35157),g=t(82550),j=t(37783),v=t(34e3),y=t(16861),S=t(47933),w=t(74711),b=new Intl.Collator(navigator.language,{sensitivity:"base"}),AutomaterializeTagWithEvaluation=function(e){var n=e.assetKeys,t=e.evaluationId,i=m.useMemo(function(){return(0,g._)(n).sort(function(e,n){return b.compare(e.path.join("/"),n.path.join("/"))})},[n]);return(0,o.jsx)(j.J,{placement:"bottom",content:(0,o.jsxs)("div",{style:{width:"340px"},children:[(0,o.jsx)(l.x,{padding:{vertical:8,horizontal:12},border:"bottom",style:{fontWeight:600},children:"Auto-materialized"}),(0,o.jsx)(l.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(function(e){var n=(0,w.p)(e,{view:"auto-materialize-history",evaluation:t});return(0,o.jsxs)(l.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsx)(v.JO,{name:"asset"}),(0,o.jsx)(y.g,{text:e.path.join("/")})]}),(0,o.jsx)(S.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,o.jsx)(d.V,{icon:"auto_materialize_policy",children:"Auto-materialized"})})},R=t(28252),_=t(90818),T=t(51969),C=t(37160),I=t(26997),O=t(51892),N=t(85333),k=t(6692),F=t(58467),E=t(64595),L=t(43180),z=t(9001),D=t(10735),K=t(25195),A=t(35505),J=t(66904),P=t(82329),V=t(56266),Q=t(84692),U=t(18960),q=t(61935),useFavicon=function(e){m.useEffect(function(){var n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(n){var t=n.getAttribute("href");return n.setAttribute("href",e),function(){t&&n.setAttribute("href",t)}}},[e])},W=t(71277),M=t(502),H=t(40157),B=t(96956),Z=t(27124),G=t(56307),X=t(72205),Y=t(95388),$=t(63650),ee=t(51332),en=t(53068),et=t(52623);function _templateObject(){var e=(0,i._)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n"]);return _templateObject=function(){return e},e}var runStatusFavicon=function(e){switch(e){case q.VOA.FAILURE:return"/favicon-run-failed.svg";case q.VOA.SUCCESS:return"/favicon-run-success.svg";case q.VOA.STARTING:case q.VOA.STARTED:case q.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},Run=function(e){var n=e.run,t=e.runId,i=(0,F._)((0,et.Bz)(),2),r=i[0],s=i[1],l=(0,F._)((0,W.q)({queryKey:"selection",defaults:{selection:""}}),2),a=l[0],u=l[1];useFavicon(n?runStatusFavicon(n.status):"/favicon.svg"),(0,R.j)(n?"".concat((0,f.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));var onShowStateDetails=function(e,n){var t=n.find(function(n){return"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e});t&&(0,J._)({body:(0,o.jsx)(V.T9,{error:t})})},onSetSelectionQuery=function(e){u(e),s((0,k._)((0,N._)({},r),{logQuery:"*"!==e?[{token:"query",value:e}]:[]}))};return(0,o.jsx)($.A.Provider,{value:n,children:(0,o.jsx)(Z.C,{runId:t,children:function(e){return(0,o.jsx)(ee.jp,{logs:e,children:function(i){return(0,o.jsx)(RunWithData,{run:n,runId:t,logs:e,logsFilter:r,metadata:i,selectionQuery:a,onSetLogsFilter:s,onSetSelectionQuery:onSetSelectionQuery,onShowStateDetails:onShowStateDetails})}})}},t)})},logTypeFromQuery=function(e){switch(e){case"stdout":return X.hi.stdout;case"stderr":return X.hi.stderr;default:return X.hi.structured}},RunWithData=function(e){var n=e.run,t=e.runId,i=e.logs,r=e.logsFilter,s=e.metadata,a=e.selectionQuery,u=e.onSetLogsFilter,c=e.onSetSelectionQuery,d=(0,F._)((0,W.q)({queryKey:"logType",defaults:{logType:X.hi.structured}}),2),x=d[0],h=d[1],f=logTypeFromQuery(x),j=(0,F._)(m.useState(null),2),y=j[0],S=j[1],w=JSON.stringify(Object.keys(s.steps).sort()),b=m.useMemo(function(){return JSON.parse(w)},[w]),R=(null==n?void 0:n.executionPlan)&&(0,U.J)(null==n?void 0:n.executionPlan,s.steps),_=m.useMemo(function(){return R&&a&&"*"!==a?(0,P.V)(R,a).all.map(function(e){return e.name}):[]},[R,a]),T=(0,M.a)(),C=(0,en.r)({stepKeys:b,selectionStepKeys:_,metadata:s,defaultToFirstStep:!1}),I=C.logCaptureInfo,O=C.computeLogFileKey,N=C.setComputeLogFileKey,k=R?r.logQuery.filter(function(e){return e.token&&"query"===e.token}).reduce(function(e,n){return(0,g._)(e).concat((0,g._)((0,P.V)(R,n.value).all.map(function(e){return e.name})))},[]):[],K=(0,F._)(m.useState(null),2),A=K[0],J=K[1];m.useEffect(function(){switch(null==A?void 0:A.getSize()){case 100:Z("top");return;case 0:Z("bottom");return}},[A]);var V=(0,F._)(m.useState(null),2),q=V[0],Z=V[1],$="top"===q,ee="bottom"===q,resetPanels=function(){null==A||A.onChangeSize(50),Z(null)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(D.O,{ref:function(e){J(e)},axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,o.jsx)(Q.Fu,{run:n}):n.executionPlan&&R?(0,o.jsx)(E.S,{region:"gantt chart",children:(0,o.jsx)(Q.hj,{options:{mode:Q.hS.WATERFALL_TIMED},toolbarActions:(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,o.jsx)(L.u,{content:$?"Collapse":"Expand",children:(0,o.jsx)(z.zx,{icon:(0,o.jsx)(v.JO,{name:$?"collapse_arrows":"expand_arrows"}),onClick:$?resetPanels:function(){null==A||A.onChangeSize(100),Z("top")}})}),(0,o.jsx)(Y.NX,{run:n,graph:R,metadata:s,selection:{query:a,keys:_}})]}),runId:t,graph:R,metadata:s,selection:{query:a,keys:_},onClickStep:function(e,n){var t,i=_.indexOf(e),o='"'.concat(e,'"');if(n.shiftKey)t=(0,g._)(_.map(function(e){return a.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e})),-1!==i?t.splice(i,1):t.push(o);else if(1===_.length&&-1!==i)t=[];else{t=[o];var r=(0,en.c)(s.logCaptureSteps,e);r&&N(r)}c(t.join(", ")||"*")},onSetSelection:c,focusedTime:r.focusedTime})}):(0,o.jsx)(p.t,{icon:"error",title:"Unable to build execution plan"}):(0,o.jsx)(Q.ZW,{runId:t}),second:(0,o.jsx)(E.S,{region:"logs",children:(0,o.jsxs)(ei,{children:[(0,o.jsx)(X.KZ,{logType:f,onSetLogType:function(e){return h(X.hi[e])},filter:r,onSetFilter:u,steps:b,metadata:s,computeLogFileKey:O,onSetComputeLogKey:N,computeLogUrl:y,counts:i.counts,isSectionExpanded:ee,toggleExpanded:ee?resetPanels:function(){null==A||A.onChangeSize(0),Z("bottom")}}),f!==X.hi.structured?O?T?(0,o.jsx)(H.h,{logKey:O?[t,"compute_logs",O]:[],logCaptureInfo:I,visibleIOType:X.hi[f],onSetDownloadUrl:S}):(0,o.jsx)(B.K,{runId:t,computeLogFileKey:b.length?O:void 0,ioType:X.hi[f],setComputeLogUrl:S}):(0,o.jsx)(NoStepSelectionState,{type:f}):(0,o.jsx)(G.S,{logs:i,filter:r,filterStepKeys:k,filterKey:"".concat(JSON.stringify(r)),metadata:s})]})})})})},ei=A.ZP.div.withConfig({componentId:"sc-638062d9-0"})(_templateObject()),NoStepSelectionState=function(e){var n=e.type;return(0,o.jsx)(l.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:(0,K.v8)()},children:(0,o.jsx)(p.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})},eo=t(81862),er=t(87612),es=t(22970),el=t(33379),ea=t(59692),eu=t(44678),ec=t(10952),ed=t(94092),ep=t(34263),em=t(19211),ex=t(47544),eh=t(26704),ef=t(17791),eg=t(16148),ej=t(38153),ev=t(16530),ey=t(6315),eS=t(85893),ew=t(38917),eb=t(16322);function RunConfigDialog_templateObject(){var e=(0,i._)(["\n  flex: 1;\n  overflow: hidden;\n\n  .CodeMirror {\n    height: 100%;\n  }\n"]);return RunConfigDialog_templateObject=function(){return e},e}var RunConfigDialog=function(e){var n,t,i,r,s=e.run,a=e.isJob,c=s.runConfigYaml,d=(0,F._)(m.useState(null),2),p=d[0],h=d[1],f=m.useContext(ep.I).rootServerURI,g=m.useContext(ew.Lw).refetch,y=(0,ex.m)(),S=(0,x.k6)(),w=(0,F._)((0,el.D)(eh.FREE_CONCURRENCY_SLOTS_MUTATION),1)[0],b=(n=(0,eo._)(function(){return(0,es.Jh)(this,function(e){switch(e.label){case 0:return y(c),[4,(0,em.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Copied!"})];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)}),R=(t=(0,eo._)(function(){var e;return(0,es.Jh)(this,function(n){switch(n.label){case 0:return[4,w({variables:{runId:s.id}})];case 1:if(!(null===(e=n.sent().data)||void 0===e?void 0:e.freeConcurrencySlots))return[3,3];return[4,(0,em.B7)({intent:"success",icon:"check_circle",message:"Freed concurrency slots"})];case 2:n.sent(),n.label=3;case 3:return[2]}})}),function(){return t.apply(this,arguments)}),_=(0,ej.$O)({id:s.id,repositoryName:null===(i=s.repositoryOrigin)||void 0===i?void 0:i.repositoryName,repositoryLocationName:null===(r=s.repositoryOrigin)||void 0===r?void 0:r.repositoryLocationName,pipelineName:s.pipelineName,isJob:a});return(0,o.jsxs)("div",{children:[(0,o.jsxs)(ea.Z,{direction:"row",spacing:8,children:[s.hasReExecutePermission?(0,o.jsx)(eg.A,{icon:(0,o.jsx)(v.JO,{name:"edit"}),to:_,children:"Open in Launchpad"}):(0,o.jsx)(L.u,{content:ef.U,useDisabledButtonTooltipFix:!0,children:(0,o.jsx)(z.zx,{icon:(0,o.jsx)(v.JO,{name:"edit"}),disabled:!0,children:"Open in Launchpad"})}),(0,o.jsx)(z.zx,{icon:(0,o.jsx)(v.JO,{name:"tag"}),onClick:function(){return h("config")},children:"View tags and config"}),(0,o.jsx)(j.J,{position:"bottom-right",content:(0,o.jsxs)(eu.v2,{children:[(0,o.jsx)(L.u,{content:"Loadable in dagster-webserver-debug",position:"left",targetTagName:"div",children:(0,o.jsx)(eu.sN,{text:"Download debug file",icon:(0,o.jsx)(v.JO,{name:"download_for_offline"}),onClick:function(){return window.open("".concat(f,"/download_debug/").concat(s.id))}})}),s.hasConcurrencyKeySlots&&ey.cv.has(s.status)?(0,o.jsx)(eu.sN,{text:"Free concurrency slots",icon:(0,o.jsx)(v.JO,{name:"lock"}),onClick:R}):null,s.hasDeletePermission?(0,o.jsx)(eu.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:function(){return h("delete")}}):null]}),children:(0,o.jsx)(z.zx,{icon:(0,o.jsx)(v.JO,{name:"expand_more"})})})]}),(0,o.jsx)(ec.Vq,{isOpen:"config"===p,onClose:function(){return h(null)},style:{width:"90vw",maxWidth:"1000px",minWidth:"600px",height:"90vh",maxHeight:"1000px",minHeight:"600px"},title:"Run configuration",children:(0,o.jsxs)(l.x,{flex:{direction:"column"},style:{flex:1,overflow:"hidden"},children:[(0,o.jsxs)(l.x,{flex:{direction:"column",gap:20},style:{flex:1,overflow:"hidden"},children:[(0,o.jsxs)(l.x,{flex:{direction:"column",gap:12},padding:{top:16,horizontal:24},children:[(0,o.jsx)(u.pm,{children:"Tags"}),(0,o.jsx)("div",{children:(0,o.jsx)(eS.Q,{tags:s.tags,mode:a?null:s.mode})})]}),(0,o.jsxs)(l.x,{flex:{direction:"column"},style:{flex:1,overflow:"hidden"},children:[(0,o.jsx)(l.x,{border:"bottom",padding:{left:24,bottom:16},children:(0,o.jsx)(u.pm,{children:"Config"})}),(0,o.jsx)(eR,{children:(0,o.jsx)(ed.u,{value:c,options:{readOnly:!0,lineNumbers:!0,mode:"yaml"},theme:["config-editor"]})})]})]}),(0,o.jsxs)(ec.cN,{topBorder:!0,children:[(0,o.jsx)(z.zx,{onClick:function(){return b()},intent:"none",children:"Copy config"}),(0,o.jsx)(z.zx,{onClick:function(){return h(null)},intent:"primary",children:"OK"})]})]})}),s.hasDeletePermission?(0,o.jsx)(ev.N,{isOpen:"delete"===p,onClose:function(){return h(null)},onComplete:function(){s.repositoryOrigin?S.push((0,ej.jT)({repoName:s.repositoryOrigin.repositoryName,repoLocation:s.repositoryOrigin.repositoryLocationName,pipelineName:s.pipelineName,isJob:a,path:"/runs"})):h(null)},onTerminateInstead:function(){return h("terminate")},selectedRuns:(0,er._)({},s.id,s.canTerminate)}):null,s.hasTerminatePermission?(0,o.jsx)(eb.A,{isOpen:"terminate"===p,onClose:function(){return h(null)},onComplete:function(){g()},selectedRuns:(0,er._)({},s.id,s.canTerminate)}):null]})},eR=A.ZP.div.withConfig({componentId:"sc-a9990906-0"})(RunConfigDialog_templateObject()),e_=t(91916),eT=t(87424),eC=t(84495),eI=t(46032),eO=t(30301),eN=t(76487),RunTimingTags=function(e){var n=e.loading,t=e.run;return(0,o.jsxs)(o.Fragment,{children:[(null==t?void 0:t.startTime)?(0,o.jsx)(j.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(l.x,{padding:16,children:(0,o.jsx)(eN.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eO.v,{timestamp:t.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):t.updateTime?(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eO.v,{timestamp:t.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)?(0,o.jsx)(j.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(l.x,{padding:16,children:(0,o.jsx)(eN.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"timer",children:(0,o.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==t?void 0:t.startTime)?(0,eI.R4)(((null==t?void 0:t.endTime)*1e3||Date.now())-(null==t?void 0:t.startTime)*1e3):"–"})})}):null]})},ek=t(12084),eF=t(32911),TickTagForRun=function(e){var n=e.instigationSelector,t=e.instigationType,i=e.tickId,r=(0,F._)(m.useState(!1),2),s=r[0],l=r[1],a=t===eC.H.ScheduleName?"schedule":"sensors",u=n.name;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.V,{icon:a,children:(0,o.jsxs)("span",{children:["Launched by"," ",(0,o.jsx)(ek.Z,{onClick:function(){return l(!0)},children:(0,o.jsx)("div",{style:{maxWidth:"140px"},children:(0,o.jsx)(y.g,{text:u})})})]})}),(0,o.jsx)(eF.X,{isOpen:s,onClose:function(){return l(!1)},instigationSelector:n,tickId:Number(i)})]})};function RunRoot_templateObject(){var e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return RunRoot_templateObject=function(){return e},e}var RunRoot=function(){(0,h.Px)();var e,n=(0,x.UO)().runId;(0,R.j)(n?"Run ".concat(n.slice(0,8)):"Run");var t=(0,r.a)(eL,{variables:{runId:n}}),i=t.data,s=t.loading,p=(null==i?void 0:i.pipelineRunOrError.__typename)==="Run"?i.pipelineRunOrError:null,g=null==p?void 0:p.pipelineSnapshotId,j=(0,I.n)(p),v=(null==j?void 0:j.match)?(0,C.kQ)(j.match.repository.name,j.match.repositoryLocation.name):null,y=m.useMemo(function(){return!!(p&&j&&(0,T.E8)(j.match,p.pipelineName))},[p,j]),S=m.useMemo(function(){return(null==p?void 0:p.tags.find(function(e){return e.key===eC.H.AssetEvaluationID}))||null},[p]),w=m.useMemo(function(){if(v){var e=(null==p?void 0:p.tags)||[],n=e.find(function(e){return e.key===eC.H.TickId});if(n){var t=e.find(function(e){return e.key===eC.H.ScheduleName||e.key===eC.H.SensorName});if(t){var i={name:t.value,repositoryName:v.name,repositoryLocationName:v.location};return{tickId:n.value,instigationType:t.key,instigationSelector:i}}}}return null},[p,v]);return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,o.jsx)(l.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,o.jsx)(a.m,{title:(0,o.jsx)(u.X6,{style:{fontFamily:c.b.monospace,fontSize:"20px"},children:n.slice(0,8)}),tags:p?(0,o.jsxs)(l.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(0,o.jsx)(eT.KG,{status:p.status}),(0,f.pv)(p.pipelineName)?null:(0,o.jsxs)(d.V,{icon:"run",children:["Run of"," ",(0,o.jsx)(_.h,{pipelineName:null==p?void 0:p.pipelineName,pipelineHrefContext:v||"repo-unknown",snapshotId:g,size:"small",isJob:y})]}),w?(0,o.jsx)(TickTagForRun,{instigationSelector:w.instigationSelector,instigationType:w.instigationType,tickId:w.tickId}):null,(0,o.jsx)(O.m,{useTags:!0,assetChecks:p.assetCheckSelection}),(0,o.jsx)(O.h,{useTags:!0,assetKeys:(0,f.pv)(p.pipelineName)?(0,ew.Bo)(p):p.assets.map(function(e){return e.key})}),(0,o.jsx)(RunTimingTags,{run:p,loading:s}),S&&(null===(e=p.assetSelection)||void 0===e?void 0:e.length)?(0,o.jsx)(AutomaterializeTagWithEvaluation,{assetKeys:p.assetSelection,evaluationId:S.value}):null]}):null,right:p?(0,o.jsx)(RunConfigDialog,{run:p,isJob:y}):null})}),(0,o.jsx)(RunById,{data:i,runId:n})]})},eE=RunRoot,RunById=function(e){var n=e.data,t=e.runId;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,o.jsx)(l.x,{padding:{vertical:64},children:(0,o.jsx)(p.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,o.jsx)(Run,{run:n.pipelineRunOrError,runId:t}):(0,o.jsx)(Run,{run:void 0,runId:t})},eL=(0,s.Ps)(RunRoot_templateObject(),e_.tQ)}}]);
//# sourceMappingURL=173.5767ddc943a94f65.js.map