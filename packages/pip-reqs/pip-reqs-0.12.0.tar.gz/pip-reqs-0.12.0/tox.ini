[tox]
# Having the .tox directory in the project directory slows down the
# `pip install -e .` step required by `usedevelop = true` considerably.
# By moving it out of the way (~500MB), we trim test execution time by > 80%.
skipsdist = true
# skip_missing_interpreters = true
toxworkdir = {homedir}/.toxenvs/pip-reqs
envlist =
    test-py{37,38,39,310,311}-pip{22.0.4,22.1.2,22.2.2,22.3.1,23.0.1,23.1.2,23.2.1,23.3.1},
    test-py{312}-pip{23.1.2,23.2.1,23.3.1},
    coverage

[testenv]
setenv =
    COVERAGE_FILE = .artifacts/coverage.{env:TOX_ENV_NAME}
deps =
    test: pytest
    test: pytest-cov
    test: mock
    lint: flake8
    coverage: coverage
    pip22.0.4: pip==22.0.4
    pip22.1.2: pip==22.1.2
    pip22.2.2: pip==22.2.2
    pip22.3.1: pip==22.3.1
    pip23.0.1: pip==23.0.1
    pip23.1.2: pip==23.1.2
    pip23.2.1: pip==23.2.1
    pip23.3.1: pip==23.3.1
commands =
    test: py.test -rxs --cov-report= --cov pip_reqs --pyargs {posargs:pip_reqs}

[testenv:coverage]
setenv =
    COVERAGE_FILE = .artifacts/coverage
commands =
    coverage combine .artifacts/
    coverage html
    coverage report

[flake8]

[pytest]
filterwarnings =
    ignore:the imp module is deprecated.*:DeprecationWarning
